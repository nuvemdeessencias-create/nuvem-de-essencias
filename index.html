
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuvem De Ess√™ncias | Cat√°logo Oficial</title>

  <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#b89356">
    <link rel="apple-touch-icon" href="img/icon-192.png">
    <link href="https://fonts.googleapis.com/css2?family=Playball&display=swap" rel="stylesheet">
    
    <style>
/* 1. CONFIGURA√á√ïES GERAIS E CORES */
:root {
    --azul-fundo: #020b1f; 
    --azul-card: #ffffff; 
    --dourado: #b89356;
    --texto-escuro: #333333;
    --verde-whats: #25d366;
    --cinza-botao: #000000;
}

body { 
    font-family: 'Segoe UI', sans-serif; 
    margin: 0; 
    background-color: var(--azul-fundo); 
    color: white; 
    overflow-x: hidden; 
}

/* 2. CABE√áALHO DO SITE */
header { 
    background: var(--azul-fundo); 
    padding: 15px 5%; 
    display: flex;
    align-items: center;
    justify-content: space-between; 
    position: sticky;
    top: 0;
    z-index: 1000;
    border-bottom: 1px solid rgba(184, 147, 86, 0.3);
}

.logo-img { width: 180px; height: auto; }

.cart-icon-container {
    background: var(--dourado);
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: bold;
    color: white;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

#cart-count { background: white; color: var(--azul-fundo); padding: 2px 6px; border-radius: 50%; font-size: 11px; }

/* 3. ESTRUTURA DA SACOLA (MODAL) */
.cart-modal {
    position: fixed;
    top: 0;
    right: -100%;
    width: 100%;
    max-width: 380px;
    height: 100vh;
    background: white;
    z-index: 2000;
    transition: 0.4s;
    display: flex;
    flex-direction: column;
    padding: 0;
    overflow: hidden;
    box-shadow: -5px 0 20px rgba(0,0,0,0.5);
}

/* 1. Ajuste do Modal para aceitar o aviso fixo no topo */
.cart-modal.active { 
    right: 0; 
    display: flex;         /* Isso organiza os elementos em linha/coluna */
    flex-direction: column; /* Isso empilha o t√≠tulo, o aviso e os itens */
}
/* 2. Ajuste da √°rea de rolagem para respeitar o aviso */
#cart-scroll-area {
    flex: 1;               /* ADICIONADO: Faz a lista ocupar o espa√ßo que sobrar */
    overflow-y: auto;
    padding: 20px;
    -webkit-overflow-scrolling: touch;
}

.cart-footer {
    padding: 20px;
    border-top: 1px solid #eee;
    background: white;
    flex-shrink: 0;
    z-index: 10;
}

/* ////////////////////////////////////////////////// */
/* AJUSTE PARA PONTOS AO LADO DA SACOLA */
.header-actions {
    display: flex;
    align-items: center;
    gap: 10px; /* Espa√ßo entre o bot√£o e a sacola */
}

.btn-login-header {
    background: var(--dourado);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
    font-size: 11px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
/* ////////////////////////////////////////////////// */

        

/* 4. RODAP√â PROFISSIONAL NUVEM (CORRIGIDO) */
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;1,600&family=Poppins:wght@300;400;600&display=swap');

.rodape-container {
    background-color: var(--azul-fundo); 
    color: #ffffff;
    padding: 40px 5% 20px;
    border-top: 1px solid rgba(184, 147, 86, 0.3);
    font-family: 'Poppins', sans-serif;
}

.rodape-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: flex-start;
    gap: 30px;
}

.rodape-col { flex: 1; min-width: 250px; }

.rodape-frase-dourada {
    font-family: 'Playfair Display', serif;
    color: var(--dourado);
    font-style: italic;
    font-size: 1.2rem;
    margin-bottom: 15px;
}

.link-whats {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #ffffff;
    text-decoration: none;
    font-weight: 600;
    font-size: 16px;
    margin: 15px 0;
}

.link-whats:hover { color: var(--verde-whats); }

/* Estilo do bot√£o de WhatsApp dentro do Ver Detalhes */
.btn-whats-modal {
    background-color: #25d366; /* Verde oficial do WhatsApp */
    color: white;
    border: none;
    padding: 12px 20px;
    width: 100%;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 15px; /* Espa√ßo para n√£o colar na descri√ß√£o */
}

.btn-whats-modal:hover {
    background-color: #128c7e; /* Verde mais escuro ao passar o mouse */
}

.pagamento-titulo {
    font-size: 14px;
    font-weight: bold;
    text-transform: uppercase;
    margin-bottom: 15px;
    color: var(--dourado);
}

.pagamento-icones {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    align-items: center;
}

/* IMPORTANTE: Removido o filtro que deixava as imagens brancas */
.pagamento-icones img {
    height: 30px !important;
    width: auto !important;
    filter: none !important;
    -webkit-filter: none !important;
    opacity: 1 !important;
}

.rodape-alert {
    font-size: 11px;
    color: #aaa;
    line-height: 1.6;
    margin-top: 20px;
}

.simbolo-perfume-footer {
    width: 120px !important; /* Aumentado conforme solicitado */
    height: auto;
    margin-bottom: 10px;
    display: block;
    margin-left: auto;
    filter: none !important;
}

.rodape-bottom {
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid rgba(255,255,255,0.1);
    text-align: center;
    font-size: 12px;
    color: #888;
}

/* 5. GRID E CARDS DE PRODUTO */
.container { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); 
    gap: 20px; 
    padding: 20px; 
    max-width: 1200px; 
    margin: 0 auto; 
}

/* Redu√ß√£o da altura da imagem para economizar espa√ßo no topo */

/* 6. BOT√ïES DE VARIA√á√ÉO (ML/KIT) */
.variacao-container {
    display: flex !important;
    gap: 6px !important;            /* Espa√ßo menor entre bot√µes */
    justify-content: center !important;
    margin: 4px 0 !important;      /* Reduzido de 10px para 4px para encurtar o card */
    flex-wrap: wrap !important;
    width: 100%;
}

/* Estilo para o seletor de Batons e Velas */
.seletor-estilo-aba {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
    font-size: 14px;
    color: #333;
    cursor: pointer;
    outline: none;
    transition: border-color 0.3s;
}

.seletor-estilo-aba:focus {
    border-color: var(--dourado);
}

.btn-ml-nuvem {
    min-width: 45px !important;
    height: 45px !important;
    width: auto !important;
    padding: 0 6px !important;
    border: 1px solid #d1d9e6 !important;
    background-color: #f0f4f8 !important;
    border-radius: 6px !important;
    cursor: pointer !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    transition: all 0.2s ease !important;
    box-sizing: border-box !important;
}

.btn-ml-nuvem.active {
    border: 2px solid #007bff !important;
    background-color: #e1ecf7 !important;
}

.btn-ml-nuvem span {
    font-size: 11px !important;
    font-weight: bold !important;
    color: #333 !important;
}

/* 7. BOT√ÉO ADICIONAR √Ä SACOLA */
.btn-add-sacola {
    background: black !important;
    color: white !important;
    border: none;
    padding: 12px;
    width: 90%;
    border-radius: 8px;
    cursor: pointer;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
    margin-top: 10px;
}

/* RESPONSIVIDADE */
@media (max-width: 768px) {
    .rodape-content { flex-direction: column; text-align: center; }
    .link-whats, .pagamento-icones { justify-content: center; }
    .simbolo-perfume-footer { margin: 0 auto 10px auto; }
    .rodape-col { text-align: center !important; }
}

.logo-text {
    font-family: 'Playfair Display', serif;
    color: #87CEEB; 
    font-size: 1.20rem;
    letter-spacing: 1px;
    text-transform: uppercase;
}

.slogan {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    color: #c5a059;
    font-size: 1.0rem;
    margin-bottom: 5px;
}

/* 5. INPUTS E BOT√ïES */
#cep-cliente {
    flex: 1;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 12px;
    font-size: 16px;
    outline: none;
    background: white;
    color: #333;
}


/* Bot√£o Base: Quadrado Pequeno */
.btn-ml-nuvem {
    min-width: 45px !important; /* Largura m√≠nima para ser quadrado */
    height: 45px !important;    /* Altura fixa menor para encurtar o card */
    width: auto !important;     /* Deixa expandir se for Kit */
    padding: 0 6px !important;
    border: 1px solid #d1d9e6 !important;
    background-color: #f0f4f8 !important;
    border-radius: 6px !important;
    cursor: pointer !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    transition: all 0.2s ease !important;
}
        

/* Quando selecionado */
.btn-ml-nuvem.active {
    border: 2px solid #007bff !important;
    background-color: #e1ecf7 !important;
}

/* Ajuste do texto */
.btn-ml-nuvem span {
    font-size: 11px !important;
    font-weight: bold !important;
    color: #333 !important;
    line-height: 1.1 !important;
    text-align: center;
}

/* NOVAS ETIQUETAS DE PRE√áO NUVEM DE ESS√äNCIAS */
.tag-promo-pix {
    background: #e8f5e9 !important; /* Verde Suave */
    color: #2e7d32 !important;      /* Verde Texto */
    padding: 4px 12px !important;
    border-radius: 6px !important;
    font-size: 11px !important;     /* Aumentamos de 8px para 11px */
    font-weight: 800 !important;
    display: inline-flex !important;
    align-items: center;
    gap: 5px;
    border: 1px solid #c8e6c9 !important;
    margin-top: 5px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.tag-promo-6x {
    background: #fff3e0 !important; /* Laranja Suave */
    color: #ef6c00 !important;      /* Laranja Texto */
    padding: 4px 12px !important;
    border-radius: 6px !important;
    font-size: 11px !important;
    font-weight: 800 !important;
    display: inline-flex !important;
    align-items: center;
    gap: 5px;
    border: 1px solid #ffe0b2 !important;
    margin-top: 3px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

/* Ajuste do container de pre√ßo e do parcelamento solicitado */
[id^="preco-container-"] {
    min-height: auto !important; 
    margin: 2px 0 !important;
    padding: 2px 0 !important;
    display: flex;
    flex-direction: column;
    align-items: center;
}

 /* Estilo solicitado: 10x sem juros em Azul Escuro e maior */
.parcelamento-azul {
    color: #002d72 !important; /* Azul escuro */
    font-size: 12px !important; /* Aumentado */
    font-weight: 700 !important;
    margin-bottom: 4px;2
}

  /* Aviso Profissional Deslizante */
.aviso-nuvem {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #020b1f; /* Azul da sua marca */
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    border-left: 5px solid #b89356; /* Dourado */
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    z-index: 99999;
    display: flex;
    align-items: center;
    gap: 15px;
    font-family: 'Segoe UI', sans-serif;
    animation: deslizarEntrada 0.5s ease-out;
}

@keyframes deslizarEntrada {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.aviso-nuvem.erro { border-left-color: #ff4444; } /* Vermelho para erros */
.aviso-nuvem b { color: #b89356; }

        
/* FILTROS */
.filtros-container { padding: 20px 15px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
.busca-grupo { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; width: 100%; }
select, .busca-input { padding: 12px; border: 1px solid var(--dourado); border-radius: 8px; width: 100%; max-width: 300px; }

.categorias-nav { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-top: 10px; }
.btn-categoria { background: transparent; border: 1px solid var(--dourado); color: white; padding: 6px 15px; border-radius: 20px; cursor: pointer; font-size: 11px; font-weight: bold; }
.btn-categoria.active { background: var(--dourado); }

/* GRID E CARDS */
.container { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; padding: 20px; max-width: 1200px; margin: 0 auto; }

.card {
    background: var(--azul-card);
    color: var(--texto-escuro);
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    /* Reduzi drasticamente o padding inferior de 20px para 8px */
    padding-bottom: 8px !important; 
    box-shadow: 0 8px 15px rgba(0,0,0,0.2);
    position: relative;
    /* Adicionado para garantir que o card n√£o estique al√©m do necess√°rio */
    height: fit-content;
}
        
/* Redu√ß√£o da altura da imagem para economizar espa√ßo no topo */
.card img { 
    width: 100%; 
    height: 130px !important; /* Reduzido de 140/180px para 130px */
    object-fit: contain; 
    background: white; 
    padding: 5px 0 !important; 
}
.info { width: 90%; text-align: center; }
.marca-tag { color: var(--dourado); font-weight: bold; font-size: 11px; text-transform: uppercase; }
/* Ajuste do nome para ocupar menos espa√ßo */
.nome-perfume { 
    font-size: 14px !important; /* Reduzido de 15px */
    font-weight: bold; 
    color: var(--azul-fundo); 
    margin: 2px 0 !important; /* Margem m√≠nima */
    min-height: 34px !important; /* Reduzido de 40px */
    display: flex; 
    align-items: center; 
    justify-content: center; 
    line-height: 1.1; 
}

/* Redu√ß√£o das margens das etiquetas de estoque e varia√ß√µes */
.estoque-label { 
    font-size: 10px !important; 
    margin-bottom: 4px !important; 
}
/* Selo de Oferta que fica em cima da imagem */
.selo-promo {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #d32f2f; /* Vermelho vibrante */
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: bold;
    z-index: 10;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* SELETOR QTD */
.qtd-container { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 12px; }
.btn-qtd { width: 28px; height: 28px; border-radius: 50%; border: 1px solid #ccc; background: #f8f8f8; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
.input-qtd { width: 45px; height: 30px; text-align: center; border: 1px solid #ccc; border-radius: 4px; font-weight: bold; }

.seletor-ml { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 12px; font-size: 13px; }

.btn-whats { background: var(--verde-whats); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; }
.btn-add-cart { background: var(--dourado); color: white; border: none; padding: 10px; width: 100%; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: bold; text-transform: uppercase; }
.btn-add-sacola { background: black !important; color: white !important; border: none; padding: 12px; width: 100%; border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: bold; text-transform: uppercase; }

footer { padding: 30px; text-align: center; color: #888; font-size: 12px; border-top: 1px solid rgba(184, 147, 86, 0.2); }

/* Esconde o select antigo se ele ainda estiver no c√≥digo */
.seletor-ml {
    display: none !important;
}

/* Ajuste fino nos bot√µes para garantir o formato quadrado */
.btn-ml-nuvem {
    box-sizing: border-box !important;
}

/* --- AJUSTE DO MODAL DE DETALHES (FIX PARA DESCRIC√ïES LONGAS) --- */

/* Estiliza√ß√£o da janela branca que abre com os detalhes */
.modal-detalhes-content {
    background: white;
    color: #333;
    width: 90%;
    max-width: 500px;
    max-height: 85vh; /* Impede que o modal passe da altura da tela */
    border-radius: 15px;
    position: relative;
    padding: 20px;
    overflow-y: auto; /* Adiciona a barra de rolagem interna se o texto for grande */
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
}

/* Fixar o bot√£o de fechar no topo para ele nunca sumir */
.btn-fechar-modal {
    position: sticky; /* Ele fica "preso" no topo mesmo ao rolar o texto */
    top: 0;
    align-self: flex-end; /* Alinha √† direita */
    background: #f0f0f0;
    border: none;
    font-size: 20px;
    font-weight: bold;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: -10px; /* Compensa o espa√ßo para n√£o empurrar a imagem */
}

/* --- CORRE√á√ÉO DE ROLAGEM E BOT√ÉO FIXO --- */
.modal-detalhes-content {
    background: white;
    padding: 20px;
    border-radius: 15px;
    width: 90%;
    max-width: 450px;
    max-height: 80vh; /* Faz o modal ter no m√°ximo 80% da altura da tela */
    overflow-y: auto;  /* Ativa a rolagem se o texto for muito grande */
    position: relative;
    display: flex;
    flex-direction: column;
    color: #333;
}

.btn-fechar-modal {
    position: sticky; /* O X fica preso no topo enquanto voc√™ rola o texto */
    top: 0;
    right: 0;
    align-self: flex-end;
    background: #eee;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    font-weight: bold;
    cursor: pointer;
    z-index: 10;
}

.modal-descricao-texto {
    font-size: 14px;
    line-height: 1.5;
    white-space: pre-wrap; /* Mant√©m os par√°grafos que voc√™ digitar no Admin */
    margin: 15px 0;
}

        
    </style>
</head>
<body>

   <header style="display: flex; justify-content: space-between; align-items: center; padding: 10px 20px;">
    
    <img src="img/logo.png" alt="NUVEM DE ESS√äNCIAS" class="logo-img" style="max-height: 50px;">

    <div class="header-actions" style="display: flex; align-items: center; gap: 10px;">
    
<div id="status-pontos-container" style="display: flex; align-items: center; gap: 15px; margin-right: 10px;">
    <span id="msg-incentivo-login" style="color: #d4af37; font-family: 'Playball', cursive; font-size: 19px; font-weight: 400; white-space: nowrap; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">
        Identifique-se e ganhe pontos nesta compra ‚ú®
    </span>

    <div id="lupa-trigger" onclick="window.abrirModalLogin()" style="cursor:pointer; position: relative; width: 85px; height: 85px; display: flex; align-items: center; justify-content: center; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
        
        <div style="width: 54px; height: 54px; border-radius: 50%; background: linear-gradient(145deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c); padding: 3px; display: flex; align-items: center; justify-content: center; border: 1.5px solid #8a6d3b; position: relative; z-index: 2; box-shadow: 0 4px 10px rgba(0,0,0,0.4);">
            <div style="width: 100%; height: 100%; background: radial-gradient(circle at 30% 30%, #1e2d50, #0d1b3e); border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden;">
                <strong id="valorPontosLupa" style="font-size: 16px; color: #fff; text-shadow: 1px 1px 2px #000; font-family: sans-serif;">?</strong>
                <span id="label-lupa" style="font-size: 8px; font-weight: bold; color: #d4af37; letter-spacing: 0.5px; text-transform: uppercase;">LOGIN</span>
            </div>
        </div>

        <div style="position: absolute; top: 42px; left: 42px; width: 11px; height: 45px; background: linear-gradient(90deg, #7a1212, #c41e1e, #7a1212); transform: rotate(-45deg); border-radius: 0 0 5px 5px; border: 1.5px solid #4a0a0a; z-index: 1; transform-origin: top center;">
            <div style="position: absolute; bottom: -1px; left: -1.5px; width: 11px; height: 7px; background: linear-gradient(145deg, #bf953f, #fcf6ba, #aa771c); border: 1px solid #8a6d3b; border-radius: 0 0 4px 4px;"></div>
        </div>
    </div>
</div>
  
    <div class="cart-icon-container" onclick="toggleCart()" style="position: relative; cursor: pointer; background: #b89356; padding: 5px 12px; border-radius: 15px; display: flex; align-items: center;">
        <span style="font-size: 18px;">üõçÔ∏è</span>
        <span id="cart-count" style="color: black; font-weight: bold; margin-left: 5px;">0</span>
    </div>

</div>
</header>

<div id="cart-modal" class="cart-modal">
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #eee; background: white; flex-shrink: 0;">
        <h3 style="margin:0; color: #333;">Sua Sacola</h3>
        <span style="cursor:pointer; font-size: 28px; color: #333;" onclick="toggleCart()">√ó</span>
    </div>

    <div id="container-trava-aviso" style="padding: 0 20px; background: white; flex-shrink: 0;">
        <div id="aviso-interno-sacola" style="display:none; background: #fff9f0; border: 1px solid #b89356; color: #020b1f; padding: 12px; margin-top: 15px; border-radius: 8px; font-size: 13px; align-items: center; gap: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <span style="font-size: 18px;">‚ö†Ô∏è</span>
            <span><b>Frete Pendente:</b> Recalcule o frete para atualizar o total.</span>
        </div>
    </div>

    <div id="cart-scroll-area" style="flex-grow: 1; overflow-y: auto;">
        <div id="cart-items">
            </div>

        <div style="font-family: 'Inter', sans-serif; margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
            <h3 style="font-size: 14px; font-weight: 700; letter-spacing: 1px; margin-bottom: 10px; color: #1a1a1a;">ENTREGA</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Insira o CEP para calcular valor e prazo</p>
            
            <div style="display: flex; height: 45px; border: 1px solid #ccc; border-radius: 4px; overflow: hidden; margin-bottom: 10px;">
                <input type="text" id="cep-cliente" placeholder="Digite o CEP">
                <button onclick="calcularFrete()" style="background: #1a1a1a; color: white; border: none; padding: 0 25px; font-size: 12px; font-weight: 700; cursor: pointer; text-transform: uppercase;">
                    CALCULAR
                </button>
            </div>
            <div style="margin-bottom: 15px;">
    <a href="https://buscacepinter.correios.com.br/app/endereco/index.php" 
       target="_blank" 
       rel="noopener noreferrer" 
       style="font-size: 12px; color: #666; text-decoration: underline; font-family: sans-serif;">
       N√£o sei o meu CEP
    </a>
</div>
            
            <div id="opcoes-frete"></div>
        </div>
    </div>

   <div class="cart-footer">
    <div style="display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; color: #333; font-size: 18px;">
        <span>Total:</span>
        <span>R$ <span id="cart-total">0,00</span></span>
    </div>

   <div id="area-desconto-pontos" style="background: #020b1f; padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px solid #b8935633; display: none;">
    <p style="font-size: 12px; color: #ccc; margin: 0;">Voc√™ tem: <span id="label-pontos-disponiveis" style="color: #b89356; font-weight: bold;">0</span> pontos</p>
    <p style="font-size: 15px; color: #b89356; font-weight: bold; margin: 8px 0;">Cr√©dito dispon√≠vel: R$ <span id="valor-desconto-pwa">0,00</span></p>
    
    <button onclick="aplicarDescontoPontos()" 
            style="width: 100%; background: #b89356; color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-size: 11px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;">
        RESGATAR MEU CR√âDITO ‚ú®
    </button>
</div>

   <button class="btn-checkout-asaas" onclick="abrirCheckoutAsaas('PIX', event)" style="width: 100%; background: #2e7d32; color: white; padding: 15px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-bottom: 10px; font-size: 16px;">
    üí≥ FINALIZAR PAGAMENTO
</button>

    <button class="btn-whats-secundario" onclick="finalizarWhatsApp()" style="width: 100%; background: #25d366; color: white; padding: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 8px;">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" width="16" height="16">
        Pedir pelo WhatsApp
    </button>
</div>
</div> 
    
    <div style="border-top: 2.5px solid #b89356; border-bottom: 2.5px solid #b89356; padding: 12px 0; margin-bottom: 20px; text-align: center; background-color: rgba(184, 147, 86, 0.05);">
    <p style="color: #ffffff; font-size: 14px; margin: 0; font-weight: bold; letter-spacing: 0.5px;">
        ‚ú® Sinta o aroma dos sonhos e realce sua beleza! ‚ú®
    </p>
</div>

<div id="modal-cpf-fidelidade" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:10000; align-items:center; justify-content:center; backdrop-filter: blur(5px);">
    <div style="background:#0d1b3e; border:2px solid #b89356; padding:30px; border-radius:20px; width:90%; max-width:400px; text-align:center; box-shadow:0 0 30px rgba(184,147,86,0.4);">
        <h2 style="color:#d4af37; font-family:'Playball', cursive; font-size:32px; margin-bottom:15px;">Programa de Pontos ‚ú®</h2>
        <p style="color:#fff; font-size:14px; margin-bottom:20px;">Digite seu CPF para acessar seus cr√©ditos:</p>
       <input type="tel" id="input-cpf-modal" placeholder="000.000.000-00" 
    style="width: 100%; max-width: 280px; padding: 12px; margin: 20px auto; display: block; border-radius: 10px; border: 1px solid #b89356; background: rgba(255,255,255,0.1); color: #fff; text-align: center; font-size: 18px; outline: none; box-sizing: border-box;">
            <button id="btn-fechar-cpf" style="background:transparent; color:#fff; border:1px solid #fff; padding:10px 20px; border-radius:20px; cursor:pointer; font-size:12px; text-transform:uppercase;">Cancelar</button>
            <button id="btn-confirmar-cpf" style="background:#b89356; color:#fff; border:none; padding:10px 25px; border-radius:20px; cursor:pointer; font-weight:bold; font-size:12px; text-transform:uppercase;">Acessar Cr√©ditos</button>
        </div>
    </div>
</div>

<div id="modal-sucesso-resgate" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:10001; align-items:center; justify-content:center; backdrop-filter: blur(5px);">
    <div style="background:#0d1b3e; border:2px solid #b89356; padding:40px 30px; border-radius:25px; width:90%; max-width:350px; text-align:center; position: relative;">
        
        <div onclick="window.fecharTudoAgora()" style="position: absolute; top: 15px; right: 20px; color: #b89356; font-size: 24px; font-weight: bold; cursor: pointer; padding: 5px;">
            &times;
        </div>

        <div style="font-size: 50px; margin-bottom: 15px;">‚ú®</div>
        <h2 style="color:#d4af37; font-family:'Playball', cursive; font-size:28px; margin-bottom:10px;">Resgate Conclu√≠do!</h2>
        <p id="texto-sucesso-resgate" style="color:#fff; font-size:16px; margin-bottom:25px;">
            Cr√©dito resgatado com sucesso!
        </p>
        
        <button onclick="window.fecharTudoAgora()" style="background:#b89356; color:#fff; border:none; padding:12px 40px; border-radius:25px; cursor:pointer; font-weight:bold; text-transform:uppercase;">
            OK
        </button>
    </div>
</div>
    
<div class="filtros-container">
    <div class="busca-grupo">
        <select id="filtroMarca" onchange="filtrar()">
            <option value="todos">TODAS AS MARCAS</option>
            <optgroup label="ALTA PERFUMARIA">
                <option value="PACO RABANNE">PACO RABANNE</option>
                <option value="CHLOE">CHLOE</option>
                <option value="CAROLINA HERRERA">CAROLINA HERRERA</option>
                <option value="DIOR">DIOR</option>
                <option value="JEAN PAUL GAULTIER">JEAN PAUL GAULTIER</option>
                <option value="ARMANI">ARMANI</option>
                <option value="DOLCE & GABBANA">DOLCE & GABBANA</option>
                <option value="YVES SAINT LAURENT">YVES SAINT LAURENT</option>
                <option value="HUGO BOSS">HUGO BOSS</option>
                <option value="ADOLFO DOMINGUEZ">ADOLFO DOMINGUEZ</option>
                <option value="GABRIELA SABATINI">GABRIELA SABATINI</option>
                <option value="ANIMALE">ANIMALE</option>
                <option value="ANTONIO BANDEIRAS">ANTONIO BANDEIRAS</option>
                <option value="AZZARO">AZZARO</option>
                <option value="BVLGARI">BVLGARI</option>
                <option value="JACQUES BOGART ">JACQUES BOGART </option>
                <option value="CACHAREL">CACHAREL</option>
                <option value="CALVIN KLEIN">CALVIN KLEIN</option>
                <option value="DAVIDOFF">DAVIDOFF</option>
                <option value="GIVENCHY">GIVENCHY</option>
                <option value="JOOP">JOOP</option>
                <option value="KENZO">KENZO</option>
                <option value="NAUTICA">NAUTICA</option>
                <option value="MARINA DE BOURBON">MARINA DE BOURBON</option>
                <option value="MERCEDES BENZ">MERCEDES BENZ</option>
                <option value="RALPH LAUREN">RALPH LAUREN</option>
                <option value="SHAKIRA">SHAKIRA</option>
            </optgroup>
            <optgroup label="PERFUMARIA √ÅRABE">
                <option value="LATTAFA">LATTAFA</option>
                <option value="AL WATANIAH">AL WATANIAH</option>
                <option value="ARMAF">ARMAF</option>
                <option value="MAISON ALHAMBRA">MAISON ALHAMBRA</option>
                <option value="AFNAN">AFNAN</option>
                <option value="ORIENTICA">ORIENTICA</option>
            </optgroup>
            <optgroup label="KITS">
                <option value="KITS">KITS</option> 
            </optgroup>
            <optgroup label="CASA">
                <option value="VELAS AROMATICAS">VELAS AROM√ÅTICAS</option>
            </optgroup>
             <optgroup label="MAQUIAGEM">
                <option value="BATONS">BATONS</option>
            </optgroup>
        </select>
        <input type="text" id="buscaInput" onkeyup="filtrar()" placeholder="PESQUISAR...">
    </div>

    <div class="categorias-nav">
        <button class="btn-categoria active" onclick="filtrarCategoria('todos', this)">TODOS</button>
        <button class="btn-categoria" onclick="filtrarCategoria('alta', this)">ALTA PERFUMARIA</button>
        <button class="btn-categoria" onclick="filtrarCategoria('arabe', this)">PERFUMES √ÅRABES</button>
        <button class="btn-categoria" onclick="filtrarCategoria('casa', this)">CASA & VELAS</button>
        <button class="btn-categoria" onclick="filtrarCategoria('kits', this)">KITS</button>
         <button class="btn-categoria" onclick="filtrarCategoria('maquiagem', this)">MAQUIAGEM</button>
    </div>
</div>

<div class="container" id="listaProdutos"></div>

<script src="promocoes.js"></script>
<script src="checkout.js"></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
        getFirestore, collection, query, orderBy, onSnapshot, doc, getDoc, setDoc, updateDoc, increment 
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA9_9_NfnhbUnKUrXHUw8f0IFptCjXRf6M",
        authDomain: "nuvem-de-essencias.firebaseapp.com",
        projectId: "nuvem-de-essencias",
        storageBucket: "nuvem-de-essencias.firebasestorage.app",
        messagingSenderId: "929136751660",
        appId: "1:929136751660:web:408079a808e0918ede0d89"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window.db = db;
    window.meusProdutos = [];

    // --- CARREGAMENTO DE PRODUTOS (MANTIDO DO SEU ORIGINAL) ---
    const q = query(collection(db, "produtos"), orderBy("ordem", "asc"));
    onSnapshot(q, (snapshot) => {
        window.meusProdutos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        if (typeof carregarProdutos === "function") carregarProdutos(window.meusProdutos);
        verificarLinkDireto();
    });

  // --- RESGATE DE PONTOS (VERS√ÉO PROTEGIDA) ---
window.aplicarDescontoPontos = async function() {
    const cpfSalvo = localStorage.getItem('cpfCliente');
    const elementoValor = document.getElementById('valor-desconto-pwa');
    const labelPontos = document.getElementById('label-pontos-disponiveis'); // Pega os pontos da tela

    if (!cpfSalvo || !window.db || !elementoValor) return;

    const cpfLimpo = cpfSalvo.replace(/\D/g, '');
    const valorNumerico = parseFloat(elementoValor.innerText.replace(',', '.'));
    const pontosAtuais = parseInt(labelPontos ? labelPontos.innerText : "0");

    // --- TRAVA DE SEGURAN√áA  ---
    if (pontosAtuais <= 0) {
        alert("Voc√™ n√£o possui pontos suficientes para resgate!");
        return;
    }

    try {
        const clienteRef = doc(window.db, "clientes", cpfLimpo);
        
        // Em vez de calcular, for√ßamos o valor para 0 de forma segura
        await updateDoc(clienteRef, { "pontos": 0 }); 
        
        localStorage.setItem('descontoAtivo', valorNumerico.toString());

        // Abre o modal de sucesso
        const msgSucesso = document.getElementById('texto-sucesso-resgate');
        if (msgSucesso) {
            msgSucesso.innerHTML = `Cr√©dito de <b>R$ ${valorNumerico.toFixed(2).replace('.', ',')}</b> aplicado!`;
        }
        document.getElementById('modal-sucesso-resgate').style.display = 'flex';

        if (typeof renderizarSacola === 'function') renderizarSacola();
    } catch (error) {
        console.error("Erro no resgate:", error);
        alert("Erro ao processar resgate. Tente novamente.");
    }
};

    // --- NOVA FUN√á√ÉO: RECUPERAR PONTOS SE DESISTIR ---
 window.cancelarResgate = async function() {
    const cpf = localStorage.getItem('cpfCliente');
    const valorDesconto = localStorage.getItem('descontoAtivo');
    
    if (!cpf || !valorDesconto) return;

    // Converte o valor de volta para pontos (R$ 1,00 = 50 pts)
    const pontosParaDevolver = Math.round(parseFloat(valorDesconto) / 0.02);

    try {
        const cpfLimpo = cpf.replace(/\D/g, '');
        const clienteRef = doc(db, "clientes", cpfLimpo);

        // USANDO INCREMENT: Ele soma ao valor atual, evitando saldo negativo ou perda de pontos
        await updateDoc(clienteRef, { 
            "pontos": increment(pontosParaDevolver) 
        });
        
        localStorage.removeItem('descontoAtivo'); // Limpa o desconto
        
        if (typeof renderizarSacola === 'function') renderizarSacola();
        
        alert("Pontos devolvidos ao seu saldo! ‚ú®");
    } catch (e) {
        console.error("Erro ao devolver pontos:", e);
        alert("Erro ao recuperar pontos. Tente novamente.");
    }
};
    // --- LOGIN COM MODAL (SUBSTITUI O PROMPT) ---
    window.abrirModalLogin = () => {
        document.getElementById('modal-cpf-fidelidade').style.display = 'flex';
    };

    window.confirmarCPFModal = async function() {
        const input = document.getElementById('input-cpf-modal');
        const cpf = input.value.replace(/\D/g, '');
        
        if (cpf.length !== 11) {
            alert("Digite os 11 n√∫meros do CPF.");
            return;
        }

        const clienteRef = doc(db, "clientes", cpf);
        try {
            const docSnap = await getDoc(clienteRef);
            if (!docSnap.exists()) {
                await setDoc(clienteRef, { pontos: 0, cpf: cpf, dataCriacao: new Date().toISOString() });
            }
            ativarMonitoramento(cpf);
            document.getElementById('modal-cpf-fidelidade').style.display = 'none';
        } catch (e) { console.error(e); }
    };

    // --- MONITORAMENTO (MELHORADO COM OP√á√ÉO DE CANCELAR) ---
// --- MONITORAMENTO (VERS√ÉO FINAL SEM BUGS DE VISIBILIDADE) ---
window.ativarMonitoramento = function(cpf) {
    localStorage.setItem('cpfCliente', cpf);
    const clienteRef = doc(db, "clientes", cpf);
    
    onSnapshot(clienteRef, (docAtualizado) => {
        if (docAtualizado.exists()) {
            const dados = docAtualizado.data();
            const descontoAtivo = localStorage.getItem('descontoAtivo');

            // 1. Atualiza a Lupa
            const elementoPontos = document.getElementById('valorPontosLupa');
            const elementoLabel = document.getElementById('label-lupa');
            if (elementoPontos) elementoPontos.innerText = dados.pontos;
            if (elementoLabel) elementoLabel.innerText = "PONTOS";

            // 2. L√≥gica de Texto Lateral e Bot√£o Cancelar
            const msgIncentivo = document.getElementById('msg-incentivo-login');
            if (msgIncentivo) {
                // PRIORIDADE: Se houver desconto ativo, mostra CANCELAR independente do saldo
                if (descontoAtivo) {
                    msgIncentivo.innerHTML = `
                        <div style="text-align: right; line-height: 1.2;">
                            <span style="color: #ff4444; font-weight: bold; font-size: 13px;">‚ú® Cr√©dito em Uso</span><br>
                            <a href="javascript:void(0)" onclick="window.cancelarResgate()" style="color: #ff4444; font-size: 10px; text-decoration: underline; font-weight: bold;">VOLTAR PONTOS (CANCELAR)</a>
                            <a href="javascript:void(0)" onclick="window.deslogarCliente()" style="color: #999; font-size: 10px; margin-left: 8px;">üîí Sair</a>
                        </div>`;
                } else {
                    msgIncentivo.innerHTML = `
                        <div style="text-align: right; line-height: 1.2;">
                            <span style="color: #d4af37; font-family: 'Playball', cursive; font-size: 18px;">Seu Saldo ‚ú®</span><br>
                            <a href="javascript:void(0)" onclick="window.deslogarCliente()" style="color: #999; font-size: 10px; text-decoration: none;">
                                üîí <span style="text-decoration: underline;">Sair / Trocar CPF</span>
                            </a>
                        </div>`;
                }
            }

            // 3. √Årea de Resgate no Checkout (Bot√£o Aplicar)
            const areaDesconto = document.getElementById('area-desconto-pontos');
            if(areaDesconto) {
                // S√ì mostra o bot√£o de "APLICAR" se tiver pontos E n√£o tiver um desconto j√° ativo
                if (dados.pontos > 0 && !descontoAtivo) {
                    areaDesconto.style.display = 'block';
                    if(document.getElementById('label-pontos-disponiveis')) 
                        document.getElementById('label-pontos-disponiveis').innerText = dados.pontos;
                    
                    const valorCredito = (dados.pontos * 0.02).toFixed(2).replace('.', ',');
                    if(document.getElementById('valor-desconto-pwa')) 
                        document.getElementById('valor-desconto-pwa').innerText = valorCredito;
                } else {
                    areaDesconto.style.display = 'none';
                }
            }
        }
    });
}
    // --- EVENTOS DE CLIQUE PARA OS BOT√ïES (EVITA O ERRO "NOT DEFINED") ---
    document.addEventListener('click', function(e) {
       if (e.target.id === 'btn-confirmar-cpf') window.confirmarCPFModal();
        if (e.target.id === 'btn-fechar-cpf') document.getElementById('modal-cpf-fidelidade').style.display = 'none';
        if (e.target.id === 'btn-ok-sucesso') document.getElementById('modal-sucesso-resgate').style.display = 'none';
    });

    // --- MANTIDO DO SEU ORIGINAL ---
    document.addEventListener('DOMContentLoaded', () => {
        const cpfSalvo = localStorage.getItem('cpfCliente');
        if (cpfSalvo && cpfSalvo.length === 11) ativarMonitoramento(cpfSalvo);
    });

    function verificarLinkDireto() {
        const urlParams = new URLSearchParams(window.location.search);
        const pDoLink = urlParams.get('p');
        if (!pDoLink) return;
        const aguardar = setInterval(() => {
            if (window.meusProdutos && window.meusProdutos.length > 0) {
                const produtoEncontrado = window.meusProdutos.find(item => {
                    const nomeURL = item.nome.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim().replace(/\s+/g, '-');
                    return nomeURL === pDoLink.toLowerCase();
                });
                if (produtoEncontrado) { clearInterval(aguardar); abrirDetalhes(produtoEncontrado); }
            }
        }, 500);
        setTimeout(() => clearInterval(aguardar), 10000);
    }


// FUN√á√ÉO PARA FECHAR APENAS OS MODAIS DE PONTOS
window.fecharTudoAgora = function() {
    console.log("Fechando modais de fidelidade...");

    // 1. Esconde o modal de sucesso
    const modalSucesso = document.getElementById('modal-sucesso-resgate');
    if (modalSucesso) modalSucesso.style.display = 'none';

    // 2. Esconde o modal de CPF
    const modalCPF = document.getElementById('modal-cpf-fidelidade');
    if (modalCPF) modalCPF.style.display = 'none';

    // 3. Libera o scroll da p√°gina
    document.body.style.overflow = 'auto';

    // NOTA: Removemos as linhas que mexiam no 'cart-modal' e na 'cart-overlay'
    // Assim, a sacola n√£o √© mais "travada" por essa fun√ß√£o.
    
    console.log("Modais fechados. Sacola preservada.");
};

    // FOR√áAR A ABERTURA DA SACOLA (Corre√ß√£o de Travamento)
window.toggleCart = function() {
    const sacola = document.getElementById('cart-modal');
    const overlay = document.querySelector('.cart-overlay');
    
    if (!sacola) return;

    // Se a sacola estiver escondida, n√≥s mostramos
    if (!sacola.classList.contains('active')) {
        sacola.style.right = "0px"; // Limpa o -100% anterior
        sacola.classList.add('active');
        if (overlay) overlay.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Trava o scroll do fundo
    } else {
        // Se j√° estiver aberta, n√≥s fechamos
        sacola.style.right = "-100%";
        sacola.classList.remove('active');
        if (overlay) overlay.style.display = 'none';
        document.body.style.overflow = 'auto'; // Libera o scroll
    }
};
    
// FUN√á√ÉO PARA DESLOGAR (LIMPAR CPF)
window.deslogarCliente = function() {
    if (confirm("Deseja realmente sair deste CPF?")) {
        localStorage.removeItem('cpfCliente');
        localStorage.removeItem('descontoAtivo');
        console.log("Sess√£o encerrada pelo usu√°rio.");
        window.location.reload(); // Recarrega para voltar √† estaca zero
    }
};
    
</script>


    
<script>
function exibirAviso(mensagem, tipo = 'info') {
    const antigo = document.querySelector('.aviso-nuvem');
    if (antigo) antigo.remove();

    const div = document.createElement('div');
    div.className = `aviso-nuvem ${tipo === 'erro' ? 'erro' : ''}`;
    const icone = tipo === 'erro' ? '‚ö†Ô∏è' : '‚ú®';
    
    div.innerHTML = `
        <span style="font-size: 20px;">${icone}</span>
        <div style="font-size: 14px; line-height: 1.4;">${mensagem}</div>
        <span onclick="this.parentElement.remove()" style="cursor:pointer; margin-left:10px; opacity:0.5;">‚úï</span>
    `;

    document.body.appendChild(div);
    setTimeout(() => { if(div) div.remove(); }, 6000);
}
    
window.toggleCart = function() {
    const modal = document.getElementById('cart-modal');
    if (modal) {
        modal.classList.toggle('active');
    } else {
        console.error("Erro: cart-modal n√£o encontrado");
    }
};

// --- VARI√ÅVEIS GLOBAIS ---
let sacola = []; 
let valorFreteGlobal = 0;
let nomeFreteGlobal = "";
let cepCalculadoGlobal = ""; // Guarda o CEP que foi usado para calcular o frete
// --- INICIALIZA√á√ÉO ---
window.onload = function() {
    // A carga de produtos foi removida daqui pois o Firebase 
    // agora cuida disso automaticamente via onSnapshot.

    // MANTEMOS ESTA PARTE:
    const anoReal = document.getElementById("ano-real");
    if(anoReal) {
        anoReal.textContent = new Date().getFullYear();
    }
};

// --- FUN√á√ïES DE FILTRO ---
function filtrarCategoria(categoria, elemento) {
    document.querySelectorAll('.btn-categoria').forEach(btn => btn.classList.remove('active'));
    if (elemento) elemento.classList.add('active');
    filtrar(); 
}

function filtrar() {
    const marcaSelecionada = document.getElementById('filtroMarca').value.toUpperCase();
    const termoBusca = document.getElementById('buscaInput').value.toUpperCase();
    
    // Identifica qual categoria est√° ativa via bot√£o
    const btnAtivo = document.querySelector('.btn-categoria.active');
    let categoriaAtiva = "todos";
    if(btnAtivo) {
        // Extrai a categoria do texto ou do atributo de clique
        const clickAttr = btnAtivo.getAttribute('onclick');
        if(clickAttr.includes('alta')) categoriaAtiva = 'alta';
        else if(clickAttr.includes('arabe')) categoriaAtiva = 'arabe';
        else if(clickAttr.includes('casa')) categoriaAtiva = 'casa';
        else if(clickAttr.includes('kits')) categoriaAtiva = 'kits';
        else if(clickAttr.includes('maquiagem')) categoriaAtiva = 'maquiagem';
    }

    const filtrados = meusProdutos.filter(p => {
        const bateMarca = (marcaSelecionada === 'TODOS' || p.marca.toUpperCase() === marcaSelecionada);
        const bateBusca = p.nome.toUpperCase().includes(termoBusca);
        
        // Verifica se o produto pertence √† categoria (checa p.categoria ou p.secao)
        const catProduto = (p.categoria || p.secao || "").toLowerCase();
        const bateCategoria = (categoriaAtiva === 'todos' || catProduto.includes(categoriaAtiva));
        
        return bateMarca && bateBusca && bateCategoria;
    });

    carregarProdutos(filtrados);
}

 function carregarProdutos(lista = meusProdutos) {
    const container = document.getElementById('listaProdutos');
    if (!container) return;
    container.innerHTML = ""; 

    lista.forEach(p => {
        try {
            // Verifica√ß√£o de seguran√ßa: se n√£o houver op√ß√µes, pula para o pr√≥ximo produto
            if (!p.opcoes || p.opcoes.length === 0) return;

            const primeiraOpcao = p.opcoes[0];
            const valorSplit = primeiraOpcao.valor.split('|');
            const mlInicial = valorSplit[0];
            const precoOriginal = parseFloat(valorSplit[1]) || 0;
            
            // Chama a fun√ß√£o do seu arquivo promocoes.js
            const promo = processarPrecoProduto({ id: p.id, marca: p.marca, preco: precoOriginal, ml: mlInicial });
            const pDados = JSON.stringify(p).replace(/"/g, '&quot;');

            const secaoProduto = (p.secao || "").toLowerCase().trim();
            const ehPerfume = secaoProduto === "alta" || secaoProduto === "arabe" || secaoProduto === "kits";

            let seletorHtml = "";
            if (ehPerfume) {
                seletorHtml = `
                    <div class="variacao-container" style="margin-bottom: 10px;">
                        ${p.opcoes.map((opt, idx) => `
                            <button class="btn-ml-nuvem ${idx === 0 ? 'active' : ''}" 
                                    onclick="selecionarVariacaoManual('${p.id}', '${opt.valor}', '${p.marca}', this)">
                                ${opt.valor.split('|')[0]}
                            </button>`).join('')}
                    </div>`;
            } else {
                seletorHtml = `
                    <div style="width: 100%; display: flex; justify-content: center; margin-bottom: 10px;">
                        <select class="seletor-estilo-aba" style="width: 90%; padding: 8px; border-radius: 8px; border: 1px solid #ccc; background: #fff;" 
                                onchange="selecionarVariacaoSelect('${p.id}', this.value, '${p.marca}')">
                            ${p.opcoes.map((opt) => `
                                <option value="${opt.valor}">${opt.texto || opt.valor.split('|')[0]}</option>
                            `).join('')}
                        </select>
                    </div>`;
            }

            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                ${promo.emPromocao ? `<div class="selo-promo">OFERTA</div>` : ''}
                <img src="${p.imagem}" class="img-principal" alt="${p.nome}" onclick="abrirDetalhes(${pDados})" style="cursor:pointer;">
                <div class="info-container" style="padding: 0 10px; width: 100%; box-sizing: border-box; display: flex; flex-direction: column; align-items: center;">
                    <span class="marca-tag">${p.marca}</span>
                    <div class="nome-perfume">${p.nome}</div>
                    <div id="preco-container-${p.id}" style="margin: 5px 0; min-height: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%;"></div>
                    <div class="estoque-label" id="estoque-${p.id}" style="font-size:12px; font-weight:bold; margin-bottom: 8px; color: ${primeiraOpcao.disponivel ? '#d32f2f' : 'red'}">
    ${primeiraOpcao.disponivel ? primeiraOpcao.estoque + (primeiraOpcao.estoque === 1 ? ' unidade' : ' unidades') : 'INDISPON√çVEL'}
</div>
                    ${seletorHtml}
                    <div class="qtd-container" style="margin-bottom: 15px;">
                        <button class="btn-qtd" onclick="alterarQtd('q-${p.id}', -1, '${p.id}')">-</button>
                        <input type="text" id="q-${p.id}" value="${primeiraOpcao.disponivel ? 1 : 0}" readonly class="input-qtd">
                        <button class="btn-qtd" onclick="alterarQtd('q-${p.id}', 1, '${p.id}')">+</button>
                    </div>
                    <input type="hidden" id="ml-${p.id}" value="${primeiraOpcao.valor}">
                    <div class="btn-container-acoes" style="display:flex; flex-direction:column; gap:8px; width:100%; align-items:center;">
                        <button class="btn-add-cart" onclick='abrirDetalhes(${pDados})' style="width:100% !important;">VER DETALHES</button>
                        <div id="btn-container-${p.id}" style="width:100%; display:flex; justify-content:center;">
                            ${primeiraOpcao.disponivel ? 
                                `<button class="btn-add-sacola" onclick="adicionarComPromocao('${p.id}', '${p.nome}', 'ml-${p.id}', 'q-${p.id}')" style="width:100% !important;">+ ADICIONAR √Ä SACOLA</button>` : 
                                `<button class="btn-add-sacola" style="background:#000; color:#fff; width:100% !important;" disabled>ESGOTADO</button>`}
                        </div>
                    </div>
                </div>`; 
            container.appendChild(card);
            atualizarPrecoCard(p.id, primeiraOpcao.valor, p.marca);
        } catch (err) {
            console.error("Erro ao carregar produto:", p.nome, err);
        }
    });
}


// --- MANIPULA√á√ÉO DE VARIA√á√ïES (BOT√ïES QUADRADOS - PERFUMES) ---
function selecionarVariacaoManual(id, valorSelt, marca, elemento) {
    const card = elemento.closest('.card');
    card.querySelectorAll('.btn-ml-nuvem').forEach(b => b.classList.remove('active'));
    elemento.classList.add('active');

    // Executa a l√≥gica comum de atualiza√ß√£o
    processarTrocaDeVariacao(id, valorSelt, marca, card);
}

// --- MANIPULA√á√ÉO DE VARIA√á√ïES (ABA/SELECT - BATONS E VELAS) ---
function selecionarVariacaoSelect(id, valorSelt, marca) {
    const containerPreco = document.getElementById(`preco-container-${id}`);
    const card = containerPreco.closest('.card');

    // Executa a l√≥gica comum de atualiza√ß√£o
    processarTrocaDeVariacao(id, valorSelt, marca, card);
}

// --- FUN√á√ÉO MESTRE (PROCESSA TUDO: PRE√áO, ESTOQUE E IMAGEM) ---
function processarTrocaDeVariacao(id, valorSelt, marca, card) {
    // 1. Atualiza o valor no input oculto para a sacola
    document.getElementById(`ml-${id}`).value = valorSelt;

    const produto = meusProdutos.find(p => p.id === id);
    const opcao = produto.opcoes.find(o => o.valor === valorSelt);

    // 2. Atualiza Pre√ßo e Parcelamento (em azul)
    atualizarPrecoCard(id, valorSelt, marca);

    // 3. Troca a Imagem se houver uma imagem espec√≠fica para a cor/fragr√¢ncia
    // Ela verifica tanto 'imagemCor' quanto 'img' para ser compat√≠vel
    const novaImg = opcao.imagemCor || opcao.img;
    if (novaImg) {
        card.querySelector('.img-principal').src = novaImg;
    }

    // 4. Atualiza Estoque e Bot√£o de Compra
    const labelEstoque = document.getElementById(`estoque-${id}`);
    const containerBotao = document.getElementById(`btn-container-${id}`);
    const inputQtd = document.getElementById(`q-${id}`);

    if (opcao.estoque > 0 && opcao.disponivel) {
    // Esta linha abaixo faz a m√°gica do singular/plural
    const textoUnidade = opcao.estoque === 1 ? ' unidade' : ' unidades';
    labelEstoque.innerText = `${opcao.estoque}${textoUnidade}`;
    
    labelEstoque.style.color = "#d32f2f";
    containerBotao.innerHTML = `<button class="btn-add-sacola" onclick="adicionarComPromocao('${id}', '${produto.nome}', 'ml-${id}', 'q-${id}')">+ ADICIONAR √Ä SACOLA</button>`;
    inputQtd.value = 1;
    } else {
        labelEstoque.innerText = `INDISPON√çVEL`;
        labelEstoque.style.color = "red";
        containerBotao.innerHTML = `<button class="btn-add-sacola" style="background:#000; color:#fff; cursor:not-allowed;" disabled>ESGOTADO</button>`;
        inputQtd.value = 0;
    }
}

    function atualizarPrecoCard(id, valorSelt, marca) {
    const [ml, precoTexto] = valorSelt.split('|');
    const precoBase = parseFloat(precoTexto);
    const container = document.getElementById(`preco-container-${id}`);
    
    if (!container) return;

    const promo = processarPrecoProduto({ id: id, marca: marca, preco: precoBase, ml: ml });

    let html = `
        <div style="color:#333; font-weight:bold; font-size:18px; line-height: 1;">R$ ${formatarMoeda(precoBase)}</div>
        <div class="parcelamento-azul">
            at√© 10x de R$ ${formatarMoeda(precoBase/10)} sem juros
        </div>
    `;

    if (promo.emPromocao) {
        html += `<div style="display:flex; flex-direction:column; gap:3px; align-items:center; width: 100%; margin-top: 2px;">`;
        html += `<span class="tag-promo-pix">üí∞ PIX: R$ ${formatarMoeda(promo.pixValor)}</span>`;

        if (promo.tem6x) {
            html += `<span class="tag-promo-6x">üí≥ 6x de R$ ${formatarMoeda(promo.parcela6x)} (-${promo.percentual6x}%)</span>`;
        }
        html += `</div>`;
    } else {
        html += `<div style="height: 10px;"></div>`;
    }
    container.innerHTML = html;
}

 function adicionarComPromocao(id, nome, mlId, qtdId) {
    // 1. RESETAR DADOS DE FRETE (Zera tudo para n√£o cobrar valor errado)
    valorFreteGlobal = 0;
    nomeFreteGlobal = "";
    cepCalculadoGlobal = ""; 

    // 2. MOSTRAR AVISO APENAS DENTRO DA SACOLA
    // Isso ativa aquela barrinha amarela que voc√™ colocou acima do 'cart-scroll-area'
    const avisoInterno = document.getElementById('aviso-interno-sacola');
    if (avisoInterno) {
        avisoInterno.style.display = 'flex'; 
    }

    // 3. LIMPA A LISTA DE OP√á√ïES DE FRETE ANTERIORES
    const resultadoFreteHTML = document.getElementById('opcoes-frete');
    if (resultadoFreteHTML) {
        resultadoFreteHTML.innerHTML = ""; 
    }
       const selectMl = document.getElementById(mlId);
    if (!selectMl) return; // Seguran√ßa caso o elemento n√£o exista

    const [ml, precoBruto] = selectMl.value.split('|');
    const precoBase = parseFloat(precoBruto);
    const qtdInput = document.getElementById(qtdId);
    const qtd = qtdInput ? parseInt(qtdInput.value) : 1;
    
    const pOriginal = meusProdutos.find(item => item.id === id);
    if (!pOriginal) return;

    const promo = processarPrecoProduto({ id: id, marca: pOriginal.marca, preco: precoBase, ml: ml });

    // --- CASO 1: N√ÉO EST√Å EM PROMO√á√ÉO ---
    if (!promo.emPromocao) {
        sacola.push({ 
            id, nome, ml, 
            preco: precoBase, 
            qtd, 
            emPromocao: false,
            tipoPagamento: "Cart√£o at√© 10x",
            maxParcelas: 10 
        });

        // Verifica√ß√£o de seguran√ßa que voc√™ pediu
        if (typeof confirmarAdicao === "function") {
            confirmarAdicao();
        }
        
        if (typeof atualizarSacola === "function") {
            atualizarSacola();
        }
        return;
    }

    // --- CASO 2: EST√Å EM PROMO√á√ÉO (ABRIR MODAL) ---
    const container = document.getElementById('containerOpcoesPromo');
    if (!container) {
        console.error("Erro: Elemento 'containerOpcoesPromo' n√£o encontrado no HTML.");
        return;
    }
    
    container.innerHTML = ''; // Limpa bot√µes antigos

    const opcoes = [
        { texto: "√Ä VISTA NO PIX", valor: promo.pixValor, desc: "Melhor desconto", parcelas: 1, promo: true, mostrar: true },
        { texto: "CART√ÉO AT√â 6X", valor: promo.valor6x, desc: "Parcelamento exclusivo", parcelas: 6, promo: true, mostrar: promo.tem6x },
        { texto: "CART√ÉO AT√â 10X", valor: promo.valor10x, desc: "Pre√ßo original", parcelas: 10, promo: false, mostrar: true }
    ];

    opcoes.forEach(opt => {
        if (!opt.mostrar) return;

        const btn = document.createElement('button');
        const valorFormatado = opt.valor.toLocaleString('pt-br', {style: 'currency', currency: 'BRL'});
        
        btn.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center; pointer-events: none; width: 100%;">
                <div style="text-align:left;">
                    <strong style="display:block; font-size:13px; color:#fff; margin:0;">${opt.texto}</strong>
                    <span style="font-size:11px; color:#b89356;">${opt.desc}</span>
                </div>
                <div style="font-size:16px; font-weight:bold; color:#fff;">${valorFormatado}</div>
            </div>
        `;
        
        btn.style = "background:#041236; border:1px solid #1a2a4d; padding:15px; border-radius:12px; cursor:pointer; transition:0.3s; width:100%; margin-bottom:10px; display:block;";
        
        btn.onmouseover = () => btn.style.border = "1px solid #b89356";
        btn.onmouseout = () => btn.style.border = "1px solid #1a2a4d";

        btn.onclick = () => {
            sacola.push({ 
                id, nome, ml, 
                preco: opt.valor, 
                qtd, 
                emPromocao: opt.promo,
                tipoPagamento: opt.texto,
                maxParcelas: opt.parcelas 
            });
            
            // Fecha o modal azul
            const modalPromo = document.getElementById('modalPromocaoOpcoes');
            if (modalPromo) modalPromo.style.display = 'none';

            // Chamadas seguras das fun√ß√µes de feedback
            if (typeof confirmarAdicao === "function") {
                confirmarAdicao();
            }
            if (typeof atualizarSacola === "function") {
                atualizarSacola();
            }
        };
        
        container.appendChild(btn);
    });

    const modalFinal = document.getElementById('modalPromocaoOpcoes');
    if (modalFinal) {
        modalFinal.style.display = 'flex';
    } else {
        alert("Erro visual: O modal de promo√ß√£o n√£o foi encontrado no seu index.html");
    }
}
   

function atualizarSacola() {
    const itensCont = document.getElementById('cart-items');
    const totalCont = document.getElementById('cart-total');
    const countCont = document.getElementById('cart-count');
    
    let subtotal = sacola.reduce((sum, item) => sum + (item.preco * item.qtd), 0);

    if (sacola.length === 0) {
        itensCont.innerHTML = '<p style="text-align:center; color:#999; margin-top:20px;">Sacola vazia</p>';
    } else {
        itensCont.innerHTML = sacola.map((item, index) => `
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding:10px 0; color:#333;">
                <div style="text-align:left;">
                    <b style="font-size:13px;">${item.nome}</b><br>
                    <small>${item.ml} | Qtd: ${item.qtd}</small><br>
                    <small style="color:${item.emPromocao ? '#2e7d32' : '#666'}; font-weight:bold;">${item.tipoPagamento}</small>
                </div>
                <div style="text-align:right;">
                    <div style="font-size:13px; font-weight:bold;">R$ ${formatarMoeda(item.preco * item.qtd)}</div>
                    <button onclick="removerItem(${index})" style="background:none; border:none; color:red; font-size:18px;">√ó</button>
                </div>
            </div>`).join('');
    }

    const totalGeral = subtotal + valorFreteGlobal;
    totalCont.innerText = formatarMoeda(totalGeral);
    countCont.innerText = sacola.reduce((t, i) => t + i.qtd, 0);
}

// --- UTILIT√ÅRIOS ---
function formatarMoeda(valor) {
    return valor.toLocaleString('pt-br', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function alterarQtd(idInput, delta, produtoId) {
    const input = document.getElementById(idInput);
    const valorSelt = document.getElementById(`ml-${produtoId}`).value;
    const produto = meusProdutos.find(p => p.id === produtoId);
    const opcao = produto.opcoes.find(o => o.valor === valorSelt);
    let max = opcao ? opcao.estoque : 0;
    let novo = parseInt(input.value) + delta;
    if (novo >= 1 && novo <= max) input.value = novo;
}

// 1. REMOVER ITEM (CORRIGIDA)
function removerItem(index) {
    sacola.splice(index, 1); 
    valorFreteGlobal = 0;
    nomeFreteGlobal = "";
    const resultadoFrete = document.getElementById('opcoes-frete');
    if (resultadoFrete) {
        resultadoFrete.innerHTML = "<p style='color:#b89356; font-size:12px;'>Item removido. Recalcule o frete.</p>";
    }
    atualizarSacola();
}

// 2. MOSTRAR AVISO (CORRIGIDA COM SACOLA üõçÔ∏è)
function mostrarAvisoCarrinho() {
    const antigo = document.getElementById("aviso-sacola-toast");
    if(antigo) antigo.remove();

    const aviso = document.createElement('div');
    aviso.id = "aviso-sacola-toast";
    aviso.style = "position: fixed; top: 100px; right: 20px; background: #2e7d32; color: white; padding: 15px 20px; border-radius: 8px; z-index: 99999; box-shadow: 0 4px 15px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 15px; font-family: sans-serif;";
    
    aviso.innerHTML = `
        <span style="font-weight: bold;">üõçÔ∏è Adicionado com sucesso!</span>
        <button onclick="window.toggleCart(); this.parentElement.remove();" style="background: white; color: #2e7d32; border: none; padding: 8px 12px; cursor: pointer; border-radius: 4px; font-weight: bold; font-size: 12px; text-transform: uppercase;">VER AGORA</button>
        <b onclick="this.parentElement.remove()" style="cursor: pointer; font-size: 20px; padding-left: 5px;">‚úï</b>
    `;

    document.body.appendChild(aviso);
    setTimeout(() => { if(aviso) aviso.remove(); }, 5000);
}

// 3. CONFIRMAR ADI√á√ÉO (CORRIGIDA)
function confirmarAdicao() { 
    if (typeof atualizarSacola === "function") {
        atualizarSacola(); 
    }
    mostrarAvisoCarrinho(); 
}

// --- MODAL DE DETALHES ---
function abrirDetalhes(p) {
    // Se o que veio foi um ID (string), buscamos o objeto no array global
    let produto = p;
    if (typeof p === 'string') {
        produto = window.meusProdutos.find(item => item.id === p);
    }

    if (!produto) {
        console.error("Produto n√£o encontrado para abrir detalhes");
        return;
    }

    // Preenche o modal com os dados do objeto
    document.getElementById('detalhe-img').src = produto.imagem;
    document.getElementById('detalhe-nome').innerText = produto.nome;
    document.getElementById('detalhe-marca').innerText = produto.marca;
    document.getElementById('detalhe-descricao').innerText = produto.descricao || "Fragr√¢ncia exclusiva.";
    
    const msg = encodeURIComponent(`Ol√°! Gostaria de saber mais sobre: *${produto.nome}* (${produto.marca})`);
    const btn = document.getElementById('btn-whats-detalhe');
    if(btn) btn.onclick = () => window.open(`https://wa.me/5563992576211?text=${msg}`, '_blank');

    document.getElementById('modal-detalhes').style.display = 'flex';
}

// Fecha o modal ao clicar na parte escura (fundo)
window.onclick = function(event) {
    const modal = document.getElementById('modal-detalhes');
    // Se o clique for exatamente no fundo escuro e n√£o na caixa branca:
    if (event.target == modal) {
        fecharDetalhes();
    }
}

// Garante que a fun√ß√£o fecharDetalhes exista
function fecharDetalhes() {
    document.getElementById('modal-detalhes').style.display = 'none';
}
// --- FRETE E WHATSAPP ---
async function calcularFrete() {
    const cep = document.getElementById('cep-cliente').value.replace(/\D/g, '');
    cepCalculadoGlobal = cep; // Salva o CEP atual para conferir no final
    const resultadoDiv = document.getElementById('opcoes-frete');
    if (sacola.length === 0) return alert("Adicione produtos primeiro.");
    if (cep.length !== 8) return alert("CEP inv√°lido.");

    resultadoDiv.innerHTML = "<p style='color:#666'>Calculando...</p>";
    const subtotal = sacola.reduce((sum, i) => sum + (i.preco * i.qtd), 0);
    const qtdTotal = sacola.reduce((sum, i) => sum + i.qtd, 0);

    try {
        const response = await fetch('/api/calcular-frete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ cep_destino: cep, valor_total: subtotal, qtd_total: qtdTotal })
        });
        const data = await response.json();
        if(!data || data.length === 0) {
            resultadoDiv.innerHTML = "<p style='color:orange'>CEP n√£o atendido.</p>";
            return;
        }
        resultadoDiv.innerHTML = data.map(op => `
            <div class="opcao-frete-card" onclick="selecionarFrete('${op.name}', ${op.price}, this)" 
                 style="display:flex; justify-content:space-between; align-items:center; padding:12px; border:1px solid #eee; margin-top:8px; cursor:pointer; background:white; border-radius:8px;">
                <div style="text-align:left;">
                    <strong style="font-size:12px; color:#333;">${op.name}</strong><br>
                    <small style="color: #666;">Prazo: ${op.delivery_time} dias</small> 
                </div>
                <strong style="color:#b89356;">${op.price == 0 ? 'GR√ÅTIS' : 'R$ ' + formatarMoeda(op.price)}</strong>
            </div>`).join('');
    } catch (e) {
        resultadoDiv.innerHTML = "<p style='color:red;'>Erro ao calcular.</p>";
    }
}

function selecionarFrete(nome, valor, elemento) {
    valorFreteGlobal = valor;
    nomeFreteGlobal = nome;
    
    // ESCONDER O AVISO POIS O FRETE FOI RESOLVIDO
    const avisoInterno = document.getElementById('aviso-interno-sacola');
    if (avisoInterno) {
        avisoInterno.style.display = 'none';
    }

    document.querySelectorAll('.opcao-frete-card').forEach(c => c.style.borderColor = '#eee');
    elemento.style.borderColor = '#b89356';
    atualizarSacola();
}
function finalizarWhatsApp() {
    if (sacola.length === 0) return alert("Sacola vazia!");
    let texto = "*PEDIDO NUVEM DE ESS√äNCIAS*\n\n";
    sacola.forEach(i => {
        texto += `‚Ä¢ *${i.nome}* (${i.ml})\n  Qtd: ${i.qtd} | ${i.tipoPagamento}\n  Valor: R$ ${formatarMoeda(i.preco * i.qtd)}\n\n`;
    });
    texto += valorFreteGlobal > 0 ? `*Frete:* ${nomeFreteGlobal} (R$ ${formatarMoeda(valorFreteGlobal)})\n` : `*Frete:* A combinar\n`;
    texto += `*TOTAL: R$ ${document.getElementById('cart-total').innerText}*`;
    window.open(`https://wa.me/5563992576211?text=${encodeURIComponent(texto)}`, '_blank');
}


</script>


<div id="modal-detalhes" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; align-items:center; justify-content:center;">
    <div style="background:white; padding:20px; border-radius:12px; max-width:400px; width:90%; max-height: 85vh; overflow-y: auto; position:relative; color:#333; text-align:center; display: flex; flex-direction: column;">
        
        <span onclick="fecharDetalhes()" style="position: sticky; top: -10px; right: 0; align-self: flex-end; font-size:30px; cursor:pointer; background: white; width: 40px; height: 40px; line-height: 40px; border-radius: 50%; z-index: 11000; color: #333;">&times;</span>

        <img id="detalhe-img" src="" style="width:100%; height:200px; object-fit:contain; margin-bottom:15px; flex-shrink: 0;">
        
        <h2 id="detalhe-nome" style="margin:5px 0; color:#020b1f; font-size:18px; flex-shrink: 0;"></h2>
        
        <p id="detalhe-marca" style="color:#b89356; font-weight:bold; text-transform:uppercase; font-size:12px; margin-bottom: 10px; flex-shrink: 0;"></p>
        
        <p id="detalhe-descricao" style="font-size:14px; line-height:1.5; color:#666; text-align:left; white-space: pre-wrap; margin-bottom: 20px;"></p>
        
        <button id="btn-whats-detalhe" class="btn-whats-modal" style="flex-shrink: 0;">
            COMPRAR PELO WHATSAPP
        </button>
    </div>
</div>

<div id="modalCheckout" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:11000; align-items:center; justify-content:center;">
    <div style="background:white; padding:25px; border-radius:12px; max-width:450px; width:90%; color:#333;">
        <h2 style="margin-top:0; color:#020b1f;">Finalizar Compra</h2>
        
        <div style="display:grid; gap:10px;">
            <input type="text" id="cliente_nome" placeholder="Nome Completo" style="padding:10px; border:1px solid #ddd; border-radius:4px;">
            <input type="email" id="cliente_email" placeholder="E-mail" style="padding:10px; border:1px solid #ddd; border-radius:4px;">
            <input type="text" id="cliente_cpf" placeholder="CPF (apenas n√∫meros)" style="padding:10px; border:1px solid #ddd; border-radius:4px;">
            <input type="text" id="cliente_celular" placeholder="WhatsApp (com DDD)" style="padding:10px; border:1px solid #ddd; border-radius:4px;">
            
            <div style="display:flex; gap:5px;">
                <input type="text" id="end_cep" placeholder="CEP" onblur="buscarCEP(this.value)" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:4px;">
            </div>
            
            <input type="text" id="end_rua" placeholder="Rua" style="padding:10px; border:1px solid #ddd; border-radius:4px;">
            <div style="display:flex; gap:5px;">
                <input type="text" id="end_numero" placeholder="N¬∫" style="width:70px; padding:10px; border:1px solid #ddd; border-radius:4px;">
                <input type="text" id="end_bairro" placeholder="Bairro" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:4px;">
            </div>
            <input type="hidden" id="end_cidade">
            <input type="hidden" id="end_estado">
        </div>

        <div id="resumoValores" style="background:#f9f9f9; padding:10px; border-radius:8px; margin-top:15px; font-size:13px;"></div>

        <div style="display:flex; gap:10px; margin-top:20px;">
            <button type="button" onclick="coletarDadosCheckout('PIX', event)" style="flex:1; background:#00bfa5; color:white; border:none; padding:12px; border-radius:6px; font-weight:bold; cursor:pointer;">PAGAR PIX</button>
            <button type="button" onclick="coletarDadosCheckout('CREDIT_CARD', event)" style="flex:1; background:#007bff; color:white; border:none; padding:12px; border-radius:6px; font-weight:bold; cursor:pointer;">CART√ÉO</button>
        </div>
        
        <button onclick="document.getElementById('modalCheckout').style.display='none'" style="width:100%; margin-top:10px; background:none; border:none; color:gray; cursor:pointer;">Cancelar</button>
    </div>
</div>

    <div id="modalParcelas" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:30000; align-items:center; justify-content:center; backdrop-filter: blur(4px);">
    <div style="background:#fff; padding:25px; border-radius:15px; width:90%; max-width:380px; text-align:center; box-shadow:0 15px 35px rgba(0,0,0,0.5);">
        <div style="font-size: 35px; margin-bottom: 10px;">üí≥</div>
        <h3 style="margin:0 0 5px 0; color:#020b1f; font-family:sans-serif;">Parcelamento</h3>
        <p style="color:#666; font-size:14px; margin-bottom:20px;">Escolha a quantidade de parcelas:</p>
        
        <div id="listaParcelas" style="display:grid; grid-template-columns: 1fr; gap:8px; max-height:300px; overflow-y:auto; padding:5px;">
            </div>

        <button onclick="fecharModalParcelas()" style="margin-top:20px; background:none; border:none; color:#999; cursor:pointer; font-weight:bold; font-size:13px;">
            CANCELAR
        </button>
    </div>
</div>

<div id="modalPromocaoOpcoes" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:40000; align-items:center; justify-content:center; backdrop-filter: blur(5px);">
    <div style="background:#020b1f; padding:30px; border-radius:20px; width:95%; max-width:420px; text-align:center; border: 1px solid #b89356; box-shadow:0 20px 50px rgba(0,0,0,0.6);">
        <div style="font-size: 40px; margin-bottom: 10px;">‚ú®</div>
        <h3 style="margin:0 0 10px 0; color:#fff; font-family:sans-serif; letter-spacing:1px;">Oferta Especial</h3>
        <p style="color:#b89356; font-size:14px; margin-bottom:25px; font-weight:bold;">Como voc√™ prefere pagar este item?</p>
        
        <div id="containerOpcoesPromo" style="display:grid; grid-template-columns: 1fr; gap:12px;">
            </div>

        <button onclick="document.getElementById('modalPromocaoOpcoes').style.display='none'" style="margin-top:20px; background:none; border:none; color:#777; cursor:pointer; font-size:12px; text-transform:uppercase;">
            Cancelar
        </button>
    </div>
</div>
    
<footer class="rodape-container">
    <div class="rodape-content">
        
        <div class="rodape-col">
            <div class="rodape-frase-dourada">"Sinta o aroma dos sonhos e realce sua beleza!"</div>
            
            <a href="https://wa.me/5563992576211" target="_blank" class="link-contato">
                <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" width="22" height="22" alt="WhatsApp">
                (63) 99257-6211
            </a>

            <a href="https://www.instagram.com/nuvemdeessenciasperfumaria/" target="_blank" class="link-contato" style="margin-top: 10px;">
                <img src="https://cdn-icons-png.flaticon.com/512/174/174855.png" width="22" height="22" alt="Instagram">
                @nuvemdeessenciasperfumaria
            </a>

            <div class="rodape-alert">
                O √∫nico site oficial da Nuvem de Ess√™ncias √© o <br>
                <strong style="color:#fff;">www.nuvemdeessencias.com.br</strong>.<br> 
                N√£o preencha ou forne√ßa dados pessoais para links n√£o oficiais.
            </div>
        </div>

        <div class="rodape-col" style="text-align: center;">
            <div class="pagamento-titulo">Formas de Pagamento</div>
            <div class="pagamento-icones" style="justify-content: center;">
                <img src="https://upload.wikimedia.org/wikipedia/commons/d/d6/Visa_2021.svg" alt="Visa">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard">
                <img src="https://logo.svgcdn.com/logos/elo.svg" alt="Logo Elo">
                <img src="https://img.icons8.com/color/48/pix.png" alt="Pix">
            </div>
        </div>

        <div class="rodape-col" style="text-align: right;">
            <img src="img/simboloperfume.png" class="simbolo-perfume-footer" alt="Perfume">
            <div style="font-size: 14px; font-weight: bold; color: #87CEEB; letter-spacing: 1px; margin-bottom: 8px;">NUVEM DE ESS√äNCIAS PERFUMARIA</div>
            
            <div style="font-size: 12px; color: #bbb; line-height: 1.6;">
                Rua dos Motoristas, 341<br>
                Bairro Jardim Paulista<br>
                Aragua√≠na - TO
                <a href="http://maps.google.com/?q=Rua+dos+Motoristas+341+Aragua√≠na" target="_blank" style="display: inline-block; vertical-align: middle; margin-left: 5px;">
                    <img src="https://cdn-icons-png.flaticon.com/512/2991/2991231.png" width="18" height="18" alt="Google Maps" title="Ver no Maps">
                </a>
            </div>
        </div>
    </div>

    <div class="rodape-bottom">
        CNPJ: 58.620.682/0001-15 | ¬© 2026 Nuvem de Ess√™ncias Perfumaria - Todos os direitos reservados.
    </div>
</footer>

   <script>
    // Mantemos apenas o registro do Service Worker aqui
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js')
            .then(() => console.log("App Nuvem de Ess√™ncias carregado com sucesso!"))
            .catch(err => console.log("Erro ao registrar App:", err));
    }

    
</script>
</body>
</html>









































































































































































