<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuvem De Ess√™ncias | Cat√°logo Oficial</title>
    <style>
        :root {
            --azul-fundo: #020b1f; 
            --azul-card: #ffffff; 
            --dourado: #b89356;
            --texto-escuro: #333333;
            --verde-whats: #25d366;
            --cinza-botao: #333333;
        }

        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: var(--azul-fundo); color: white; overflow-x: hidden; }

        header { background: var(--azul-fundo); padding: 15px 5%; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid rgba(184, 147, 86, 0.3); }
        .logo-img { width: 180px; height: auto; }

        /* RISCOS DOURADOS E FRASE CENTRAL */
        .frase-container { display: flex; align-items: center; justify-content: center; gap: 20px; margin: 30px 0; padding: 0 5%; }
        .linha-dourada { flex: 1; height: 1px; background: linear-gradient(to right, transparent, var(--dourado), transparent); }
        .frase-central { font-family: 'Playfair Display', serif; font-style: italic; color: var(--dourado); font-size: 1.2rem; text-align: center; }

        /* CATEGORIAS E FILTROS */
        .filtros-area { text-align:center; padding: 0 5%; }
        .categorias-nav { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin: 20px 0; }
        .btn-categoria { background: transparent; border: 1px solid var(--dourado); color: white; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .btn-categoria.active { background: var(--dourado); }

        /* VITRINE DIN√ÇMICA */
        .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .card { background: var(--azul-card); color: var(--texto-escuro); border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; align-items: center; padding-bottom: 20px; box-shadow: 0 8px 15px rgba(0,0,0,0.2); }
        .card img { width: 100%; height: 200px; object-fit: contain; background: white; padding: 10px 0; }
        .nome-perfume { font-size: 15px; font-weight: bold; color: var(--azul-fundo); margin: 5px 0; min-height: 40px; display: flex; align-items: center; justify-content: center; text-align:center; padding: 0 10px; }
        .btn-add-cart { background: var(--cinza-botao); color: white; border: none; padding: 10px; width: 90%; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }

        /* SACOLA LATERAL */
        .cart-modal { position: fixed; top: 0; right: -100%; width: 100%; max-width: 380px; height: 100vh; background: white; z-index: 2000; transition: 0.4s; display: flex; flex-direction: column; box-shadow: -5px 0 20px rgba(0,0,0,0.5); color: #333; }
        .cart-modal.active { right: 0; }

        /* RODAP√â PREMIUM ORIGINAL */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;1,600&family=Poppins:wght@300;400;600&display=swap');
        .rodape-premium { background-color: #0a0c1a; color: #ffffff; padding: 50px 0 30px 0; font-family: 'Poppins', sans-serif; text-align: center; border-top: 1px solid rgba(184, 147, 86, 0.3); }
        .logo-text { font-family: 'Playfair Display', serif; color: #87CEEB; font-size: 1.2rem; text-transform: uppercase; margin: 0; }
        .slogan { font-family: 'Playfair Display', serif; font-style: italic; color: #c5a059; margin-bottom: 10px; font-size: 1.1rem; }
        .divisor { border: 0; border-top: 1px solid rgba(184, 147, 86, 0.2); margin: 25px auto; width: 80%; }
        .grid-conteudo { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; padding: 0 5%; max-width: 1200px; margin: 0 auto; text-align: left; }
        .coluna h3 { font-size: 14px; color: var(--dourado); margin-bottom: 15px; text-transform: uppercase; }
        .coluna p, .coluna a { font-size: 13px; color: #ccc; text-decoration: none; line-height: 1.6; }
        .icones-pagamento img { width: 38px; margin-right: 10px; }
        .hidden { display: none !important; }

        @media (max-width: 768px) { .grid-conteudo { text-align: center; } .icones-pagamento { justify-content: center; } }
    </style>
</head>
<body>

<header>
    <img src="img/logo.png" alt="NUVEM DE ESS√äNCIAS" class="logo-img">
    <div style="background: var(--dourado); padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; color:white;" onclick="toggleCart()">
        üõçÔ∏è <span id="cart-count">0</span>
    </div>
</header>

<div class="frase-container">
    <div class="linha-dourada"></div>
    <div class="frase-central">Aromas que encantam, ess√™ncias que marcam.</div>
    <div class="linha-dourada"></div>
</div>

<div class="filtros-area">
    <select id="filtroMarca" onchange="filtrar()" style="padding:12px; border-radius:8px; width:100%; max-width:400px; margin-bottom:10px; background: white; border: 1px solid var(--dourado);">
        <option value="todos">TODAS AS MARCAS</option>
    </select>
    <div class="categorias-nav">
        <button class="btn-categoria active" onclick="filtrarCategoria('todos', this)">TODOS</button>
        <button class="btn-categoria" onclick="filtrarCategoria('alta', this)">ALTA PERFUMARIA</button>
        <button class="btn-categoria" onclick="filtrarCategoria('arabe', this)">PERFUMES √ÅRABES</button>
        <button class="btn-categoria" onclick="filtrarCategoria('maquiagem', this)">MAQUIAGEM</button>
        <button class="btn-categoria" onclick="filtrarCategoria('casa', this)">CASA & VELAS</button>
    </div>
</div>

<div class="container" id="listaProdutos"></div>

<div id="cart-modal" class="cart-modal">
    <div style="padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;">
        <h3 style="margin:0;">Sua Sacola</h3>
        <span style="cursor:pointer; font-size: 24px;" onclick="toggleCart()">√ó</span>
    </div>
    <div id="cart-items" style="flex:1; overflow-y:auto; padding: 20px;"></div>
    
    <div style="padding: 20px; border-top: 1px solid #eee; background: #f9f9f9;">
        <h4 style="font-size: 12px; margin-bottom: 10px; color:#333;">CALCULAR ENTREGA</h4>
        <div style="display:flex; gap: 5px;">
            <input type="text" id="cep-cliente" placeholder="Seu CEP" style="flex:1; padding: 8px; border: 1px solid #ddd;">
            <button onclick="calcularFrete()" style="background: #333; color: white; border: none; padding: 0 10px; cursor:pointer;">CALCULAR</button>
        </div>
        <div id="opcoes-frete" style="margin-top: 10px; font-size: 12px; color:#333;"></div>
    </div>

    <div style="padding: 20px; border-top: 1px solid #eee;">
        <div style="display:flex; justify-content: space-between; font-weight: bold; font-size: 18px; margin-bottom: 15px;">
            <span>Total:</span>
            <span>R$ <span id="cart-total">0,00</span></span>
        </div>
        <button onclick="finalizarWhatsApp()" style="background: var(--verde-whats); color: white; border: none; width: 100%; padding: 15px; border-radius: 8px; font-weight: bold; cursor:pointer;">FINALIZAR NO WHATSAPP</button>
    </div>
</div>

<footer class="rodape-premium">
    <div class="secao-marca">
        <p class="slogan">"Sinta o aroma dos sonhos e realce sua beleza!"</p>
        <h1 class="logo-text">NUVEM DE ESS√äNCIAS PERFUMARIA</h1>
    </div>
    <hr class="divisor">
    <div class="grid-conteudo">
        <div class="coluna">
            <h3>ATENDIMENTO</h3>
            <p>Rua dos Motoristas, n¬∫ 341 - Jardim Paulista</p>
            <p>WhatsApp: (63) 99257-6211</p>
        </div>
        <div class="coluna">
            <h3>FORMAS DE PAGAMENTO</h3>
            <div class="icones-pagamento">
                <img src="https://img.icons8.com/color/38/mastercard.png" alt="Mastercard">
                <img src="https://img.icons8.com/color/38/visa.png" alt="Visa">
                <img src="https://img.icons8.com/color/38/elo.png" alt="Elo">
                <img src="https://img.icons8.com/color/38/pix.png" alt="Pix">
            </div>
        </div>
    </div>
    <div style="margin-top: 40px; font-size: 11px; color: #666;">
        <p>Nuvem de Ess√™ncias Perfumaria LTDA | CNPJ: 58.620.682/0001-15</p>
    </div>
</footer>

<script>
const REPO_CONFIG = { owner: 'nuvemdeessencias', repo: 'create', path: 'content/produtos', branch: 'teste' };
let sacola = [];
let valorFreteGlobal = 0;
let categoriaAtual = 'todos';

// CARREGA PRODUTOS E MARCAS DINAMICAMENTE
async function carregarProdutos() {
    const container = document.getElementById('listaProdutos');
    const filtroMarca = document.getElementById('filtroMarca');
    try {
        const response = await fetch(`https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}/contents/${REPO_CONFIG.path}?ref=${REPO_CONFIG.branch}`);
        const arquivos = await response.json();
        container.innerHTML = "";
        let marcasSet = new Set();
        for (const arquivo of arquivos) {
            if (arquivo.name.endsWith('.json')) {
                const res = await fetch(arquivo.download_url);
                const dados = await res.json();
                marcasSet.add(dados.marca.toUpperCase());
                renderizarCard(dados, container);
            }
        }
        marcasSet.forEach(m => {
            let opt = document.createElement('option'); opt.value = m; opt.textContent = m;
            filtroMarca.appendChild(opt);
        });
    } catch (e) { container.innerHTML = "<p>Erro ao carregar cat√°logo.</p>"; }
}

function renderizarCard(dados, container) {
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-marca', dados.marca.toUpperCase());
    card.setAttribute('data-categoria', dados.categoria);
    card.innerHTML = `
        <img src="${dados.imagem}" alt="${dados.title}">
        <div class="info">
            <span class="marca-tag">${dados.marca}</span>
            <div class="nome-perfume">${dados.title.toUpperCase()}</div>
            <p style="font-weight:bold; color:#111; margin:5px 0;">R$ ${dados.preco}</p>
            <button onclick="addCart('${dados.title}', '${dados.preco}')" class="btn-add-cart">ADICIONAR √Ä SACOLA</button>
        </div>
    `;
    container.appendChild(card);
}

// L√ìGICA DE SACOLA E FRETE (ORIGINAL)
function toggleCart() { document.getElementById('cart-modal').classList.toggle('active'); }

function addCart(nome, preco) {
    const precoNum = parseFloat(preco.replace(',', '.'));
    sacola.push({ nome, preco: precoNum });
    atualizarSacola();
    toggleCart();
}

function atualizarSacola() {
    const cont = document.getElementById('cart-items');
    let subtotal = 0;
    cont.innerHTML = sacola.length === 0 ? '<p style="text-align:center; color:#999;">Sacola vazia</p>' : 
        sacola.map(item => {
            subtotal += item.preco;
            return `<div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:13px; color:#333;">
                <span>${item.nome}</span>
                <b>R$ ${item.preco.toFixed(2).replace('.', ',')}</b>
            </div>`;
        }).join('');
    document.getElementById('cart-total').innerText = (subtotal + valorFreteGlobal).toFixed(2).replace('.', ',');
    document.getElementById('cart-count').innerText = sacola.length;
}

async function calcularFrete() {
    const cep = document.getElementById('cep-cliente').value.replace(/\D/g, '');
    const div = document.getElementById('opcoes-frete');
    if (cep.length !== 8) return alert("CEP Inv√°lido");
    div.innerHTML = "Calculando...";
    try {
        const response = await fetch('/.netlify/functions/calcular-frete', {
            method: 'POST',
            body: JSON.stringify({ cep_destino: cep })
        });
        const data = await response.json();
        div.innerHTML = data.map(op => `
            <div style="background:#fff; padding:10px; margin-top:5px; border:1px solid #ddd; cursor:pointer; border-radius:5px;" onclick="aplicarFrete(${op.price})">
                ${op.name}: <b>R$ ${op.price}</b>
            </div>
        `).join('');
    } catch (e) { div.innerHTML = "Erro ao calcular frete."; }
}

function aplicarFrete(valor) {
    valorFreteGlobal = parseFloat(valor);
    atualizarSacola();
}

function finalizarWhatsApp() {
    if (sacola.length === 0) return alert("Sacola vazia!");
    let texto = "Ol√°! Gostaria de fazer o seguinte pedido:\n\n";
    sacola.forEach(item => texto += `- ${item.nome} (R$ ${item.preco.toFixed(2).replace('.', ',')})\n`);
    if (valorFreteGlobal > 0) texto += `\nFrete: R$ ${valorFreteGlobal.toFixed(2).replace('.', ',')}`;
    texto += `\n\n*TOTAL: R$ ${document.getElementById('cart-total').innerText}*`;
    window.open(`https://wa.me/5563992576211?text=${encodeURIComponent(texto)}`);
}

function filtrar() {
    let marcaSel = document.getElementById('filtroMarca').value.toUpperCase();
    document.querySelectorAll('.card').forEach(card => {
        let matchMarca = (marcaSel === 'TODOS' || card.getAttribute('data-marca') === marcaSel);
        let matchCat = (categoriaAtual === 'todos' || card.getAttribute('data-categoria') === categoriaAtual);
        card.classList.toggle('hidden', !(matchMarca && matchCat));
    });
}

function filtrarCategoria(cat, btn) {
    categoriaAtual = cat;
    document.querySelectorAll('.btn-categoria').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    filtrar();
}

carregarProdutos();
</script>
</body>
</html>
