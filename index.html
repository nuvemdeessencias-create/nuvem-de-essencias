<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuvem De Ess√™ncias | Cat√°logo Oficial</title>
    <style>
/* 1. CONFIGURA√á√ïES GERAIS E CORES */
:root {
    --azul-fundo: #020b1f; 
    --azul-card: #ffffff; 
    --dourado: #b89356;
    --texto-escuro: #333333;
    --verde-whats: #25d366;
    --cinza-botao: #000000;
}

body { 
    font-family: 'Segoe UI', sans-serif; 
    margin: 0; 
    background-color: var(--azul-fundo); 
    color: white; 
    overflow-x: hidden; 
}

/* 2. CABE√áALHO DO SITE */
header { 
    background: var(--azul-fundo); 
    padding: 15px 5%; 
    display: flex;
    align-items: center;
    justify-content: space-between; 
    position: sticky;
    top: 0;
    z-index: 1000;
    border-bottom: 1px solid rgba(184, 147, 86, 0.3);
}

.logo-img { width: 180px; height: auto; }

.cart-icon-container {
    background: var(--dourado);
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: bold;
    color: white;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

#cart-count { background: white; color: var(--azul-fundo); padding: 2px 6px; border-radius: 50%; font-size: 11px; }

/* 3. ESTRUTURA DA SACOLA (MODAL) */
.cart-modal {
    position: fixed;
    top: 0;
    right: -100%;
    width: 100%;
    max-width: 380px;
    height: 100vh;
    background: white;
    z-index: 2000;
    transition: 0.4s;
    display: flex;
    flex-direction: column;
    padding: 0;
    overflow: hidden;
    box-shadow: -5px 0 20px rgba(0,0,0,0.5);
}

.cart-modal.active { right: 0; }

#cart-scroll-area {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    -webkit-overflow-scrolling: touch;
}

.cart-footer {
    padding: 20px;
    border-top: 1px solid #eee;
    background: white;
    flex-shrink: 0;
    z-index: 10;
}

/* 4. RODAP√â PROFISSIONAL NUVEM (CORRIGIDO) */
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;1,600&family=Poppins:wght@300;400;600&display=swap');

.rodape-container {
    background-color: var(--azul-fundo); 
    color: #ffffff;
    padding: 40px 5% 20px;
    border-top: 1px solid rgba(184, 147, 86, 0.3);
    font-family: 'Poppins', sans-serif;
}

.rodape-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: flex-start;
    gap: 30px;
}

.rodape-col { flex: 1; min-width: 250px; }

.rodape-frase-dourada {
    font-family: 'Playfair Display', serif;
    color: var(--dourado);
    font-style: italic;
    font-size: 1.2rem;
    margin-bottom: 15px;
}

.link-whats {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #ffffff;
    text-decoration: none;
    font-weight: 600;
    font-size: 16px;
    margin: 15px 0;
}

.link-whats:hover { color: var(--verde-whats); }

/* Estilo do bot√£o de WhatsApp dentro do Ver Detalhes */
.btn-whats-modal {
    background-color: #25d366; /* Verde oficial do WhatsApp */
    color: white;
    border: none;
    padding: 12px 20px;
    width: 100%;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 15px; /* Espa√ßo para n√£o colar na descri√ß√£o */
}

.btn-whats-modal:hover {
    background-color: #128c7e; /* Verde mais escuro ao passar o mouse */
}

.pagamento-titulo {
    font-size: 14px;
    font-weight: bold;
    text-transform: uppercase;
    margin-bottom: 15px;
    color: var(--dourado);
}

.pagamento-icones {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    align-items: center;
}

/* IMPORTANTE: Removido o filtro que deixava as imagens brancas */
.pagamento-icones img {
    height: 30px !important;
    width: auto !important;
    filter: none !important;
    -webkit-filter: none !important;
    opacity: 1 !important;
}

.rodape-alert {
    font-size: 11px;
    color: #aaa;
    line-height: 1.6;
    margin-top: 20px;
}

.simbolo-perfume-footer {
    width: 120px !important; /* Aumentado conforme solicitado */
    height: auto;
    margin-bottom: 10px;
    display: block;
    margin-left: auto;
    filter: none !important;
}

.rodape-bottom {
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid rgba(255,255,255,0.1);
    text-align: center;
    font-size: 12px;
    color: #888;
}

/* 5. GRID E CARDS DE PRODUTO */
.container { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); 
    gap: 20px; 
    padding: 20px; 
    max-width: 1200px; 
    margin: 0 auto; 
}

/* Redu√ß√£o da altura da imagem para economizar espa√ßo no topo */

/* 6. BOT√ïES DE VARIA√á√ÉO (ML/KIT) */
.variacao-container {
    display: flex !important;
    gap: 6px !important;            /* Espa√ßo menor entre bot√µes */
    justify-content: center !important;
    margin: 4px 0 !important;      /* Reduzido de 10px para 4px para encurtar o card */
    flex-wrap: wrap !important;
    width: 100%;
}

/* Estilo para o seletor de Batons e Velas */
.seletor-estilo-aba {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
    font-size: 14px;
    color: #333;
    cursor: pointer;
    outline: none;
    transition: border-color 0.3s;
}

.seletor-estilo-aba:focus {
    border-color: var(--dourado);
}

.btn-ml-nuvem {
    min-width: 45px !important;
    height: 45px !important;
    width: auto !important;
    padding: 0 6px !important;
    border: 1px solid #d1d9e6 !important;
    background-color: #f0f4f8 !important;
    border-radius: 6px !important;
    cursor: pointer !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    transition: all 0.2s ease !important;
    box-sizing: border-box !important;
}

.btn-ml-nuvem.active {
    border: 2px solid #007bff !important;
    background-color: #e1ecf7 !important;
}

.btn-ml-nuvem span {
    font-size: 11px !important;
    font-weight: bold !important;
    color: #333 !important;
}

/* 7. BOT√ÉO ADICIONAR √Ä SACOLA */
.btn-add-sacola {
    background: black !important;
    color: white !important;
    border: none;
    padding: 12px;
    width: 90%;
    border-radius: 8px;
    cursor: pointer;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
    margin-top: 10px;
}

/* RESPONSIVIDADE */
@media (max-width: 768px) {
    .rodape-content { flex-direction: column; text-align: center; }
    .link-whats, .pagamento-icones { justify-content: center; }
    .simbolo-perfume-footer { margin: 0 auto 10px auto; }
    .rodape-col { text-align: center !important; }
}

.logo-text {
    font-family: 'Playfair Display', serif;
    color: #87CEEB; 
    font-size: 1.20rem;
    letter-spacing: 1px;
    text-transform: uppercase;
}

.slogan {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    color: #c5a059;
    font-size: 1.0rem;
    margin-bottom: 5px;
}

/* 5. INPUTS E BOT√ïES */
#cep-cliente {
    flex: 1;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 12px;
    font-size: 16px;
    outline: none;
    background: white;
    color: #333;
}


/* Bot√£o Base: Quadrado Pequeno */
.btn-ml-nuvem {
    min-width: 45px !important; /* Largura m√≠nima para ser quadrado */
    height: 45px !important;    /* Altura fixa menor para encurtar o card */
    width: auto !important;     /* Deixa expandir se for Kit */
    padding: 0 6px !important;
    border: 1px solid #d1d9e6 !important;
    background-color: #f0f4f8 !important;
    border-radius: 6px !important;
    cursor: pointer !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    transition: all 0.2s ease !important;
}
        

/* Quando selecionado */
.btn-ml-nuvem.active {
    border: 2px solid #007bff !important;
    background-color: #e1ecf7 !important;
}

/* Ajuste do texto */
.btn-ml-nuvem span {
    font-size: 11px !important;
    font-weight: bold !important;
    color: #333 !important;
    line-height: 1.1 !important;
    text-align: center;
}

/* NOVAS ETIQUETAS DE PRE√áO NUVEM DE ESS√äNCIAS */
.tag-promo-pix {
    background: #e8f5e9 !important; /* Verde Suave */
    color: #2e7d32 !important;      /* Verde Texto */
    padding: 4px 12px !important;
    border-radius: 6px !important;
    font-size: 11px !important;     /* Aumentamos de 8px para 11px */
    font-weight: 800 !important;
    display: inline-flex !important;
    align-items: center;
    gap: 5px;
    border: 1px solid #c8e6c9 !important;
    margin-top: 5px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.tag-promo-6x {
    background: #fff3e0 !important; /* Laranja Suave */
    color: #ef6c00 !important;      /* Laranja Texto */
    padding: 4px 12px !important;
    border-radius: 6px !important;
    font-size: 11px !important;
    font-weight: 800 !important;
    display: inline-flex !important;
    align-items: center;
    gap: 5px;
    border: 1px solid #ffe0b2 !important;
    margin-top: 3px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

/* Ajuste do container de pre√ßo e do parcelamento solicitado */
[id^="preco-container-"] {
    min-height: auto !important; 
    margin: 2px 0 !important;
    padding: 2px 0 !important;
    display: flex;
    flex-direction: column;
    align-items: center;
}

 /* Estilo solicitado: 10x sem juros em Azul Escuro e maior */
.parcelamento-azul {
    color: #002d72 !important; /* Azul escuro */
    font-size: 12px !important; /* Aumentado */
    font-weight: 700 !important;
    margin-bottom: 4px;
}
        
/* FILTROS */
.filtros-container { padding: 20px 15px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
.busca-grupo { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; width: 100%; }
select, .busca-input { padding: 12px; border: 1px solid var(--dourado); border-radius: 8px; width: 100%; max-width: 300px; }

.categorias-nav { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-top: 10px; }
.btn-categoria { background: transparent; border: 1px solid var(--dourado); color: white; padding: 6px 15px; border-radius: 20px; cursor: pointer; font-size: 11px; font-weight: bold; }
.btn-categoria.active { background: var(--dourado); }

/* GRID E CARDS */
.container { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; padding: 20px; max-width: 1200px; margin: 0 auto; }

.card {
    background: var(--azul-card);
    color: var(--texto-escuro);
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    /* Reduzi drasticamente o padding inferior de 20px para 8px */
    padding-bottom: 8px !important; 
    box-shadow: 0 8px 15px rgba(0,0,0,0.2);
    position: relative;
    /* Adicionado para garantir que o card n√£o estique al√©m do necess√°rio */
    height: fit-content;
}
        
/* Redu√ß√£o da altura da imagem para economizar espa√ßo no topo */
.card img { 
    width: 100%; 
    height: 130px !important; /* Reduzido de 140/180px para 130px */
    object-fit: contain; 
    background: white; 
    padding: 5px 0 !important; 
}
.info { width: 90%; text-align: center; }
.marca-tag { color: var(--dourado); font-weight: bold; font-size: 11px; text-transform: uppercase; }
/* Ajuste do nome para ocupar menos espa√ßo */
.nome-perfume { 
    font-size: 14px !important; /* Reduzido de 15px */
    font-weight: bold; 
    color: var(--azul-fundo); 
    margin: 2px 0 !important; /* Margem m√≠nima */
    min-height: 34px !important; /* Reduzido de 40px */
    display: flex; 
    align-items: center; 
    justify-content: center; 
    line-height: 1.1; 
}

/* Redu√ß√£o das margens das etiquetas de estoque e varia√ß√µes */
.estoque-label { 
    font-size: 10px !important; 
    margin-bottom: 4px !important; 
}
/* Selo de Oferta que fica em cima da imagem */
.selo-promo {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #d32f2f; /* Vermelho vibrante */
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: bold;
    z-index: 10;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* SELETOR QTD */
.qtd-container { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 12px; }
.btn-qtd { width: 28px; height: 28px; border-radius: 50%; border: 1px solid #ccc; background: #f8f8f8; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
.input-qtd { width: 45px; height: 30px; text-align: center; border: 1px solid #ccc; border-radius: 4px; font-weight: bold; }

.seletor-ml { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 12px; font-size: 13px; }

.btn-whats { background: var(--verde-whats); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; }
.btn-add-cart { background: var(--dourado); color: white; border: none; padding: 10px; width: 100%; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: bold; text-transform: uppercase; }
.btn-add-sacola { background: black !important; color: white !important; border: none; padding: 12px; width: 100%; border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: bold; text-transform: uppercase; }

footer { padding: 30px; text-align: center; color: #888; font-size: 12px; border-top: 1px solid rgba(184, 147, 86, 0.2); }

/* Esconde o select antigo se ele ainda estiver no c√≥digo */
.seletor-ml {
    display: none !important;
}

/* Ajuste fino nos bot√µes para garantir o formato quadrado */
.btn-ml-nuvem {
    box-sizing: border-box !important;
}
        
    </style>
</head>
<body>


<header>
    <img src="img/logo.png" alt="NUVEM DE ESS√äNCIAS" class="logo-img">
    <div class="cart-icon-container" onclick="toggleCart()">
        üõçÔ∏è <span id="cart-count">0</span>
    </div>
</header>

<div id="cart-modal" class="cart-modal">
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #eee; flex-shrink: 0;">
        <h3 style="margin:0; color: #333;">Sua Sacola</h3>
        <span style="cursor:pointer; font-size: 28px; color: #333;" onclick="toggleCart()">√ó</span>
    </div>

    <div id="cart-scroll-area">
        <div id="cart-items">
            <p style="text-align:center; color:#999; margin-top: 20px;">Sacola vazia</p>
        </div>

        <div style="font-family: 'Inter', sans-serif; margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
            <h3 style="font-size: 14px; font-weight: 700; letter-spacing: 1px; margin-bottom: 10px; color: #1a1a1a;">ENTREGA</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Insira o CEP para calcular valor e prazo</p>
            
            <div style="display: flex; height: 45px; border: 1px solid #ccc; border-radius: 4px; overflow: hidden; margin-bottom: 10px;">
                <input type="text" id="cep-cliente" placeholder="Digite o CEP">
                <button onclick="calcularFrete()" style="background: #1a1a1a; color: white; border: none; padding: 0 25px; font-size: 12px; font-weight: 700; cursor: pointer; text-transform: uppercase;">
                    CALCULAR
                </button>
            </div>
            <div id="opcoes-frete"></div>
        </div>
    </div>

    <div class="cart-footer">
    <div style="display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; color: #333; font-size: 18px;">
        <span>Total:</span>
        <span>R$ <span id="cart-total">0,00</span></span>
    </div>

    <button class="btn-checkout-asaas" onclick="abrirCheckoutAsaas()" style="width: 100%; background: #2e7d32; color: white; padding: 15px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-bottom: 10px; font-size: 16px;">
        üí≥ FINALIZAR PAGAMENTO
    </button>

    <button class="btn-whats-secundario" onclick="finalizarWhatsApp()" style="width: 100%; background: #25d366; color: white; padding: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 8px;">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" width="16" height="16">
        Pedir pelo WhatsApp
    </button>
</div>

    <div style="border-top: 2.5px solid #b89356; border-bottom: 2.5px solid #b89356; padding: 12px 0; margin-bottom: 20px; text-align: center; background-color: rgba(184, 147, 86, 0.05);">
    <p style="color: #ffffff; font-size: 14px; margin: 0; font-weight: bold; letter-spacing: 0.5px;">
        ‚ú® Sinta o aroma dos sonhos e realce sua beleza! ‚ú®
    </p>
</div>
    
<div class="filtros-container">
    <div class="busca-grupo">
        <select id="filtroMarca" onchange="filtrar()">
            <option value="todos">TODAS AS MARCAS</option>
            <optgroup label="ALTA PERFUMARIA">
                <option value="PACO RABANNE">PACO RABANNE</option>
                <option value="CHLOE">CHLOE</option>
                <option value="CAROLINA HERRERA">CAROLINA HERRERA</option>
                <option value="DIOR">DIOR</option>
                <option value="JEAN PAUL GAULTIER">JEAN PAUL GAULTIER</option>
                <option value="ARMANI">ARMANI</option>
                <option value="DOLCE & GABBANA">DOLCE & GABBANA</option>
                <option value="YVES SAINT LAURENT">YVES SAINT LAURENT</option>
                <option value="HUGO BOSS">HUGO BOSS</option>
                <option value="ADOLFO DOMINGUEZ">ADOLFO DOMINGUEZ</option>
                <option value="GABRIELA SABATINI">GABRIELA SABATINI</option>
                <option value="ANIMALE">ANIMALE</option>
                <option value="ANTONIO BANDEIRAS">ANTONIO BANDEIRAS</option>
                <option value="AZZARO">AZZARO</option>
                <option value="BVLGARI">BVLGARI</option>
                <option value="JACQUES BOGART ">JACQUES BOGART </option>
                <option value="CACHAREL">CACHAREL</option>
                <option value="CALVIN KLEIN">CALVIN KLEIN</option>
                <option value="DAVIDOFF">DAVIDOFF</option>
                <option value="GIVENCHY">GIVENCHY</option>
                <option value="JOOP">JOOP</option>
                <option value="KENZO">KENZO</option>
                <option value="NAUTICA">NAUTICA</option>
                <option value="MARINA DE BOURBON">MARINA DE BOURBON</option>
                <option value="MERCEDES BENZ">MERCEDES BENZ</option>
                <option value="RALPH LAUREN">RALPH LAUREN</option>
                <option value="SHAKIRA">SHAKIRA</option>
            </optgroup>
            <optgroup label="PERFUMARIA √ÅRABE">
                <option value="LATTAFA">LATTAFA</option>
                <option value="AL WATANIAH">AL WATANIAH</option>
                <option value="ARMAF">ARMAF</option>
                <option value="MAISON ALHAMBRA">MAISON ALHAMBRA</option>
                <option value="AFNAN">AFNAN</option>
                <option value="ORIENTICA">ORIENTICA</option>
            </optgroup>
            <optgroup label="KITS">
                <option value="KITS">KITS</option> 
            </optgroup>
            <optgroup label="CASA">
                <option value="VELAS AROMATICAS">VELAS AROM√ÅTICAS</option>
            </optgroup>
             <optgroup label="MAQUIAGEM">
                <option value="BATONS">BATONS</option>
            </optgroup>
        </select>
        <input type="text" id="buscaInput" onkeyup="filtrar()" placeholder="PESQUISAR...">
    </div>

    <div class="categorias-nav">
        <button class="btn-categoria active" onclick="filtrarCategoria('todos', this)">TODOS</button>
        <button class="btn-categoria" onclick="filtrarCategoria('alta', this)">ALTA PERFUMARIA</button>
        <button class="btn-categoria" onclick="filtrarCategoria('arabe', this)">PERFUMES √ÅRABES</button>
        <button class="btn-categoria" onclick="filtrarCategoria('casa', this)">CASA & VELAS</button>
        <button class="btn-categoria" onclick="filtrarCategoria('kits', this)">KITS</button>
         <button class="btn-categoria" onclick="filtrarCategoria('maquiagem', this)">MAQUIAGEM</button>
    </div>
</div>


<div class="container" id="listaProdutos"></div>

<div id="modal-detalhes" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; align-items:center; justify-content:center;">
    <div style="background:white; padding:20px; border-radius:12px; max-width:400px; width:90%; position:relative; color:#333; text-align:center;">
        <span onclick="fecharDetalhes()" style="position:absolute; top:10px; right:15px; font-size:25px; cursor:pointer;">√ó</span>
        <img id="detalhe-img" src="" style="width:100%; height:200px; object-fit:contain; margin-bottom:15px;">
        <h2 id="detalhe-nome" style="margin:5px 0; color:#020b1f; font-size:18px;"></h2>
        <p id="detalhe-marca" style="color:#b89356; font-weight:bold; text-transform:uppercase; font-size:12px;"></p>
        <p id="detalhe-descricao" style="font-size:14px; line-height:1.5; color:#666; text-align:left;"></p>
        
        <button id="btn-whats-detalhe" class="btn-whats-modal">
            COMPRAR PELO WHATSAPP
        </button>
    </div>
</div>

<div id="modalCheckout" class="modal" style="display:none;">
    <div class="modal-content">
        <span onclick="document.getElementById('modalCheckout').style.display='none'" style="float:right; cursor:pointer; font-size:24px;">√ó</span>
        <h2>Finalizar Compra</h2>
        
        <h3>1. Dados Pessoais</h3>
        <div class="form-grupo">
            <input type="text" id="cliente_nome" placeholder="Nome Completo">
            <input type="email" id="cliente_email" placeholder="E-mail">
            <input type="text" id="cliente_cpf" placeholder="CPF (apenas n√∫meros)">
            <input type="text" id="cliente_celular" placeholder="WhatsApp">
        </div>

        <h3>2. Endere√ßo de Entrega</h3>
        <div class="form-grupo">
            <input type="text" id="end_cep" placeholder="CEP" onblur="buscarCEP(this.value)">
            <input type="text" id="end_rua" placeholder="Logradouro / Rua">
            <div style="display: flex; gap: 10px;">
                <input type="text" id="end_numero" placeholder="N¬∫" style="width: 30%;">
                <input type="text" id="end_complemento" placeholder="Complemento" style="width: 70%;">
            </div>
            <input type="text" id="end_bairro" placeholder="Bairro">
            <div style="display: flex; gap: 10px;">
                <input type="text" id="end_cidade" placeholder="Cidade" style="width: 70%;">
                <input type="text" id="end_estado" placeholder="UF" style="width: 30%;">
            </div>
        </div>

        <hr>
        
        <div id="opcoesPagamento">
            <h3>3. Pagamento</h3>
            <div id="resumoValores" style="background: #f9f9f9; padding: 10px; border-radius: 8px; margin-bottom: 15px;"></div>
            <button onclick="coletarDadosCheckout('PIX')" class="btn-pix">Pagar com PIX</button>
            <button onclick="coletarDadosCheckout('CREDIT_CARD')" class="btn-cartao">Pagar com Cart√£o</button>
        </div>
    </div>
</div>

<footer class="rodape-container">
    <div class="rodape-content">
        <div class="rodape-col">
            <div class="rodape-frase-dourada">"Sinta o aroma dos sonhos e realce sua beleza!"</div>
            <a href="https://wa.me/5563992576211" target="_blank" class="link-contato">
                <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" width="22" height="22" alt="WhatsApp"> (63) 99257-6211
            </a>
            <div class="rodape-alert">
                O √∫nico site oficial da Nuvem de Ess√™ncias √© o <br>
                <strong style="color:#fff;">www.nuvemdeessencias.com.br</strong>
            </div>
        </div>
        <div class="rodape-col" style="text-align: center;">
            <div class="pagamento-titulo">Formas de Pagamento</div>
            <div class="pagamento-icones">
                <img src="https://upload.wikimedia.org/wikipedia/commons/d/d6/Visa_2021.svg" alt="Visa" width="40">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard" width="40">
                <img src="https://img.icons8.com/color/48/pix.png" alt="Pix" width="40">
            </div>
        </div>
    </div>
    <div class="rodape-bottom">
        CNPJ: 58.620.682/0001-15 | ¬© 2026 Nuvem de Ess√™ncias Perfumaria
    </div>
</footer>

<script src="promocoes.js"></script>
<script src="produtos.js"></script>

<script>
  

    function prepararDadosParaAsaas() {
        if (typeof sacola === 'undefined' || sacola.length === 0) return null;
        let dados = {
            valorTotalPix: 0,
            valorTotalCartao6x: 0,
            valorTotalOriginal: 0,
            maxParcelasPromo: 10,
            temPromo6xAtiva: false,
            itensDetalhados: []
        };

        sacola.forEach(item => {
            const p = meusProdutos.find(prod => prod.id === item.id);
            const [mlSelt, precoSelt] = item.ml.split('|');
            const precoOriginal = parseFloat(precoSelt);
            const infoPromo = processarPrecoProduto({ id: item.id, ml: mlSelt, preco: precoOriginal });

            dados.valorTotalPix += infoPromo.pixValor * item.qtd;
            dados.valorTotalOriginal += precoOriginal * item.qtd;

            if (infoPromo.tem6x) {
                dados.maxParcelasPromo = 6;
                dados.temPromo6xAtiva = true;
                dados.valorTotalCartao6x += infoPromo.valor6x * item.qtd;
            } else {
                dados.valorTotalCartao6x += precoOriginal * item.qtd;
            }
            dados.itensDetalhados.push({ nome: p.nome, quantidade: item.qtd, precoUnitario: precoOriginal });
        });
        return dados;
    }

    function buscarCEP(cep) {
        const valor = cep.replace(/\D/g, '');
        if (valor.length !== 8) return;
        fetch(`https://viacep.com.br/ws/${valor}/json/`)
            .then(res => res.json())
            .then(dados => {
                if (!dados.erro) {
                    document.getElementById('end_rua').value = dados.logradouro;
                    document.getElementById('end_bairro').value = dados.bairro;
                    document.getElementById('end_cidade').value = dados.localidade;
                    document.getElementById('end_estado').value = dados.uf;
                    document.getElementById('end_numero').focus();
                }
            });
    }

    function coletarDadosCheckout(metodoPagamento) {
        const dadosCarrinho = prepararDadosParaAsaas();
        if (!dadosCarrinho) return alert("Seu carrinho est√° vazio!");

        const checkout = {
            cliente: {
                nome: document.getElementById('cliente_nome').value,
                email: document.getElementById('cliente_email').value,
                cpfCnpj: document.getElementById('cliente_cpf').value.replace(/\D/g, ''),
                telefone: document.getElementById('cliente_celular').value.replace(/\D/g, '')
            },
            endereco: {
                cep: document.getElementById('end_cep').value.replace(/\D/g, ''),
                rua: document.getElementById('end_rua').value,
                numero: document.getElementById('end_numero').value,
                bairro: document.getElementById('end_bairro').value,
                cidade: document.getElementById('end_cidade').value,
                estado: document.getElementById('end_estado').value
            },
            pagamento: {
                metodo: metodoPagamento,
                valor: metodoPagamento === 'PIX' ? dadosCarrinho.valorTotalPix : dadosCarrinho.valorTotalCartao6x
            }
        };

        if (!checkout.cliente.nome || !checkout.cliente.cpfCnpj || !checkout.endereco.cep) {
            return alert("Preencha Nome, CPF e CEP corretamente.");
        }
        
        console.log("Enviando para o Asaas:", checkout);
        alert("Dados validados! Pronto para conectar com a API do Asaas.");
    }

    function abrirCheckoutAsaas() {
        if (sacola.length === 0) return alert("Sua sacola est√° vazia!");
        toggleCart();
        const dados = prepararDadosParaAsaas();
        const resumoDiv = document.getElementById('resumoValores');
        if (resumoDiv) {
            resumoDiv.innerHTML = `
                <p><strong>Total PIX:</strong> R$ ${formatarMoeda(dados.valorTotalPix)}</p>
                <p><strong>Total Cart√£o:</strong> R$ ${formatarMoeda(dados.valorTotalCartao6x)} (At√© 6x c/ desc.)</p>
                <p style="font-size: 11px; color: #666;">*Op√ß√£o de 10x sem desconto dispon√≠vel no pr√≥ximo passo.</p>
            `;
        }
        document.getElementById('modalCheckout').style.display = 'flex';
    }

// --- 1. VARI√ÅVEIS GLOBAIS ---
let sacola = []; 
let valorFreteGlobal = 0;
let nomeFreteGlobal = "";

// --- 2. INICIALIZA√á√ÉO ---
window.onload = function() {
    if (typeof meusProdutos !== 'undefined') {
        carregarProdutos(meusProdutos);
    }
    // Atualiza o ano no rodap√© se o ID existir
    const anoReal = document.getElementById("ano-real");
    if(anoReal) anoReal.textContent = new Date().getFullYear();
};

// --- 3. CORE DO CARRINHO (ADICIONAR/REMOVER) ---

function adicionarAoCarrinho(produtoId) {
    const inputQtd = document.getElementById(`qtd-${produtoId}`);
    const selectMl = document.getElementById(`ml-${produtoId}`);
    
    if (!inputQtd || !selectMl) return;

    const qtd = parseInt(inputQtd.value);
    const [mlSelt, precoSelt] = selectMl.value.split('|');
    const precoBase = parseFloat(precoSelt);
    const produto = meusProdutos.find(p => p.id === produtoId);

    // Processa o pre√ßo com as regras de promo√ß√£o (do arquivo promocoes.js)
    const infoPromo = processarPrecoProduto({ id: produtoId, ml: mlSelt, preco: precoBase });

    // Criamos o item para a sacola
    const item = {
        id: produtoId,
        nome: produto.nome,
        ml: mlSelt,
        qtd: qtd,
        preco: infoPromo.pixValor, // Usando o pre√ßo PIX como base ou conforme sua regra
        tipoPagamento: "Valor no PIX",
        emPromocao: infoPromo.temPix
    };

    sacola.push(item);
    atualizarSacola();
    toggleCart(); // Abre a sacola automaticamente
}

function removerItem(index) {
    sacola.splice(index, 1); 
    valorFreteGlobal = 0;
    nomeFreteGlobal = "";
    const resultadoFrete = document.getElementById('opcoes-frete');
    if (resultadoFrete) resultadoFrete.innerHTML = "";
    atualizarSacola(); 
}

function atualizarSacola() {
    const itensCont = document.getElementById('cart-items');
    const totalCont = document.getElementById('cart-total');
    const countCont = document.getElementById('cart-count');
    
    if (!itensCont) return;

    let subtotal = sacola.reduce((sum, item) => sum + (item.preco * item.qtd), 0);

    if (sacola.length === 0) {
        itensCont.innerHTML = '<p style="text-align:center; color:#999; margin-top:20px;">Sacola vazia</p>';
    } else {
        itensCont.innerHTML = sacola.map((item, index) => `
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding:10px 0; color:#333;">
                <div style="text-align:left;">
                    <b style="font-size:13px;">${item.nome}</b><br>
                    <small>${item.ml} | Qtd: ${item.qtd}</small><br>
                    <small style="color:${item.emPromocao ? '#2e7d32' : '#666'}; font-weight:bold;">${item.tipoPagamento}</small>
                </div>
                <div style="text-align:right;">
                    <div style="font-size:13px; font-weight:bold;">R$ ${formatarMoeda(item.preco * item.qtd)}</div>
                    <button onclick="removerItem(${index})" style="background:none; border:none; color:red; font-size:18px; cursor:pointer;">√ó</button>
                </div>
            </div>`).join('');
    }

    const totalGeral = subtotal + valorFreteGlobal;
    if (totalCont) totalCont.innerText = formatarMoeda(totalGeral);
    if (countCont) countCont.innerText = sacola.reduce((t, i) => t + i.qtd, 0);
}

// --- 4. FUN√á√ïES DE INTERFACE (FILTROS/MODAIS) ---

function toggleCart() {
    const modal = document.getElementById('cart-modal');
    if (modal) modal.classList.toggle('active');
}

function formatarMoeda(valor) {
    return valor.toLocaleString('pt-br', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function carregarProdutos(lista = meusProdutos) {
    const container = document.getElementById('listaProdutos');
    if (!container) return;
    container.innerHTML = ""; 

    lista.forEach(p => {
        const card = document.createElement('div');
        card.className = 'card';
        // Aqui deve ir o c√≥digo que gera o HTML do seu card, garantindo que o bot√£o 
        // Adicionar chame: onclick="adicionarAoCarrinho(${p.id})"
        container.appendChild(card);
    });
}

function filtrar() {
    const marca = document.getElementById('filtroMarca').value.toUpperCase();
    const busca = document.getElementById('buscaInput').value.toUpperCase();
    const filtrados = meusProdutos.filter(p => {
        const bateMarca = (marca === 'TODOS' || p.marca.toUpperCase() === marca);
        const bateBusca = p.nome.toUpperCase().includes(busca);
        return bateMarca && bateBusca;
    });
    carregarProdutos(filtrados);
}

// --- 5. FRETE E FINALIZA√á√ÉO ---

async function calcularFrete() {
    const campoCep = document.getElementById('cep-cliente');
    const resultadoDiv = document.getElementById('opcoes-frete');
    if (!campoCep || sacola.length === 0) return alert("Adicione produtos primeiro.");
    
    const cep = campoCep.value.replace(/\D/g, '');
    if (cep.length !== 8) return alert("CEP inv√°lido.");

    resultadoDiv.innerHTML = "<p style='color:#666; font-size:12px;'>Calculando...</p>";
    const subtotal = sacola.reduce((sum, i) => sum + (i.preco * i.qtd), 0);

    try {
        const response = await fetch('/api/calcular-frete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ cep_destino: cep, valor_total: subtotal, qtd_total: sacola.length })
        });
        const data = await response.json();
        
        resultadoDiv.innerHTML = data.map(op => `
            <div class="opcao-frete-card" onclick="selecionarFrete('${op.name}', ${op.price}, this)" 
                 style="display:flex; justify-content:space-between; padding:10px; border:1px solid #eee; margin-top:5px; cursor:pointer; border-radius:5px;">
                <span style="font-size:11px;">${op.name}</span>
                <strong style="font-size:11px;">R$ ${formatarMoeda(op.price)}</strong>
            </div>`).join('');
    } catch (e) {
        resultadoDiv.innerHTML = "<p style='color:red;'>Erro ao calcular frete.</p>";
    }
}

function selecionarFrete(nome, valor, elemento) {
    valorFreteGlobal = valor;
    nomeFreteGlobal = nome;
    document.querySelectorAll('.opcao-frete-card').forEach(c => c.style.borderColor = '#eee');
    elemento.style.borderColor = '#b89356';
    atualizarSacola();
}

function finalizarWhatsApp() {
    if (sacola.length === 0) return alert("Sacola vazia!");
    let texto = "*NOVO PEDIDO - NUVEM DE ESS√äNCIAS*\n\n";
    sacola.forEach(i => {
        texto += `‚Ä¢ ${i.nome} (${i.ml})\n  Qtd: ${i.qtd} | R$ ${formatarMoeda(i.preco * i.qtd)}\n\n`;
    });
    if (nomeFreteGlobal) texto += `üöö *Frete:* ${nomeFreteGlobal} (R$ ${formatarMoeda(valorFreteGlobal)})\n`;
    texto += `üí∞ *TOTAL: R$ ${document.getElementById('cart-total').innerText}*`;
    window.open(`https://wa.me/5563992576211?text=${encodeURIComponent(texto)}`, '_blank');
}
    
</script>

</body>
</html>






